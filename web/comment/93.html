<!DOCTYPE html>
<html lang="en" version="XHTML+RDFa 1.0" dir="ltr">
<head profile="http://www.w3.org/1999/xhtml/vocab">
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="../sites/files/jps/starberry_favicon.png" type="image/png" />
<meta name="generator" content="Drupal 7 (https://www.drupal.org)" />
<link rel="canonical" href="../blog/2008/09/22/background-http-fetching-and-cacheing-in-aspvbscript.html" />
<link rel="shortlink" href="../node/178.html" />
  <title>Background HTTP fetching and cacheing in ASP/VBScript | J-P Stacey</title>
  <link type="text/css" rel="stylesheet" href="../sites/files/jps/css/css_xE-rWrJf-fncB6ztZfd2huxqgxu4WO-qwma6Xer30m4.css" media="all" />
<link type="text/css" rel="stylesheet" href="../sites/files/jps/css/css_jdej_Zz2sjg--A2C2aVJ-Qt5W-fI_fkFnsddutilsws.css" media="all" />
<link type="text/css" rel="stylesheet" href="../sites/files/jps/css/css_A3Qn9PgslsjDpW1HfgFuI26cQlhJ23E7y9wyYqpiJIA.css" media="all" />
<link type="text/css" rel="stylesheet" href="../sites/files/jps/css/css_0Heb-O6YY5Tn5xG4WrHtAAXZCtYk-eKiVo7PlP1bsg4.css" media="all" />
<link type="text/css" rel="stylesheet" href="../sites/files/jps/css/css_2THG1eGiBIizsWFeexsNe1iDifJ00QRS9uSd03rY9co.css" media="print" />

<!--[if lte IE 7]>
<link type="text/css" rel="stylesheet" href="http://jpstacey.lndo.site/sites/default/themes/custom/barthes/css/ie.css?qfgo2z" media="all" />
<![endif]-->

<!--[if IE 6]>
<link type="text/css" rel="stylesheet" href="http://jpstacey.lndo.site/sites/default/themes/custom/barthes/css/ie6.css?qfgo2z" media="all" />
<![endif]-->
  <script type="text/javascript" src="../sites/files/jps/js/js_vDrW3Ry_4gtSYaLsh77lWhWjIC6ml2QNkcfvfP5CVFs.js"></script>
<script type="text/javascript" src="../sites/files/jps/js/js_gPqjYq7fqdMzw8-29XWQIVoDSWTmZCGy9OqaHppNxuQ.js"></script>
<script type="text/javascript">
<!--//--><![CDATA[//><!--
(function(i,s,o,g,r,a,m){i["GoogleAnalyticsObject"]=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,"script","https://www.google-analytics.com/analytics.js","ga");ga("create", "UA-4775024-1", {"cookieDomain":"auto"});ga("set", "anonymizeIp", true);ga("send", "pageview");
//--><!]]>
</script>
<script type="text/javascript">
<!--//--><![CDATA[//><!--
jQuery.extend(Drupal.settings, {"basePath":"\/","pathPrefix":"","ajaxPageState":{"theme":"barthes","theme_token":"lSNh5IFmdhjat3R5Jag_jgyypeurEqwTs7mXkN1ztiQ","js":{"misc\/jquery.js":1,"misc\/jquery.once.js":1,"misc\/drupal.js":1,"sites\/all\/modules\/google_analytics\/googleanalytics.js":1,"0":1},"css":{"modules\/system\/system.base.css":1,"modules\/system\/system.menus.css":1,"modules\/system\/system.messages.css":1,"modules\/system\/system.theme.css":1,"modules\/comment\/comment.css":1,"sites\/all\/modules\/date\/date_api\/date.css":1,"sites\/all\/modules\/date\/date_popup\/themes\/datepicker.1.7.css":1,"modules\/field\/theme\/field.css":1,"sites\/all\/modules\/mollom\/mollom.css":1,"modules\/node\/node.css":1,"modules\/search\/search.css":1,"modules\/user\/user.css":1,"sites\/all\/modules\/views\/css\/views.css":1,"sites\/all\/modules\/media\/modules\/media_wysiwyg\/css\/media_wysiwyg.base.css":1,"sites\/all\/modules\/ctools\/css\/ctools.css":1,"public:\/\/geshi\/geshifilter-languages.css":1,"sites\/all\/modules\/geshifilter\/geshifilter.css":1,"themes\/bartik\/css\/layout.css":1,"themes\/bartik\/css\/style.css":1,"sites\/default\/themes\/custom\/barthes\/css\/colors.css":1,"sites\/default\/themes\/custom\/barthes\/css\/custom.css":1,"themes\/bartik\/css\/print.css":1,"sites\/default\/themes\/custom\/barthes\/css\/ie.css":1,"sites\/default\/themes\/custom\/barthes\/css\/ie6.css":1}},"googleanalytics":{"trackOutbound":1,"trackMailto":1,"trackDownload":1,"trackDownloadExtensions":"7z|aac|arc|arj|asf|asx|avi|bin|csv|doc(x|m)?|dot(x|m)?|exe|flv|gif|gz|gzip|hqx|jar|jpe?g|js|mp(2|3|4|e?g)|mov(ie)?|msi|msp|pdf|phps|png|ppt(x|m)?|pot(x|m)?|pps(x|m)?|ppam|sld(x|m)?|thmx|qtm?|ra(m|r)?|sea|sit|tar|tgz|torrent|txt|wav|wma|wmv|wpd|xls(x|m|b)?|xlt(x|m)|xlam|xml|z|zip"}});
//--><!]]>
</script>
</head>
<body class="html not-front not-logged-in one-sidebar sidebar-second page-node page-node- page-node-178 node-type-blog" >
  <div id="skip-link">
    <a href="93.html#main-content" class="element-invisible element-focusable">Skip to main content</a>
  </div>
    <div id="page-wrapper"><div id="page">

  <div id="header" class="with-secondary-menu"><div class="section clearfix">

    
          <div id="name-and-slogan">

                              <div id="site-name">
              <strong>
                <a href="../index.html" title="Home" rel="home"><span>J-P Stacey</span></a>
              </strong>
            </div>
                  
                  <div id="site-slogan">
            Drupal, programming culture, gardening, cycling and the environment          </div>
        
      </div> <!-- /#name-and-slogan -->
    
    
    
          <div id="secondary-menu" class="navigation">
        <h2 class="element-invisible">Secondary menu</h2><ul id="secondary-menu-links" class="links inline clearfix"><li class="menu-7322 first"><a href="../cv.html" title="My curriculum vitae">CV</a></li>
<li class="menu-7320 last"><a href="../contact.html" title="">Contact me</a></li>
</ul>      </div> <!-- /#secondary-menu -->
    
  </div></div> <!-- /.section, /#header -->

  
  
  <div id="main-wrapper" class="clearfix"><div id="main" class="clearfix">

    
    
    <div id="content" class="column"><div class="section">
            <a id="main-content"></a>
                    <h1 class="title" id="page-title">
          Background HTTP fetching and cacheing in ASP/VBScript        </h1>
                          <div class="tabs">
                  </div>
                          <div class="region region-content">
    <div id="block-system-main" class="block block-system">

    
  <div class="content">
    <div  class="ds-1col node node-blog node-promoted node-full view-mode-full clearfix">

  
  <div class="field field-name-post-date field-type-ds field-label-hidden"><div class="field-items"><div class="field-item even">Monday, September 22, 2008 - 19:25</div></div></div><div class="field field-name-field-body field-type-text-long field-label-hidden"><div class="field-items"><div class="field-item even"><p>We've recently had to integrate code with a large ASP application, which provided me with certain opinion-forming revelations about how the other half live. Part of this integration required us to write some ASP, an unexpected and un-wished-for surprise in itself. We had to generate livery in our own application---to make webpages from both sites consistent---and expose it to ASP via a HTTP call over the wire. The ASP application could then cache it, to avoid the extra per-page overhead of a HTTP call plus dynamic generation.</p>
<p>I provide below some reasonably solid HTTP fetching and cacheing in ASP/VBScript. I hesitate to add "because almost everything I found on the web was rubbish" because that would show hubris in the face of me having just had to sanitize the code, quite likely introducing typos along the way. These code samples also come with no warranty and no likelihood of me answering awkward questions about them. To invoke the fetcher/cacher, put the following in your currently executed VBScript file:</p>
<blockquote class="code"><p>
&lt;% Dim strUrl, strUrlKey, objWinHttp<br />
strUrlKey = "top_menus" %&gt;<br />
&lt;!-- #include file="fetch.inc" --&gt;<br />
. . .<br />
&lt;% strUrlKey = "side_menus" %&gt;<br />
&lt;!-- #include file="fetch.inc" --&gt;<br />
. . .<br />
&lt;% strUrlKey = "footer" %&gt;<br />
&lt;!-- #include file="fetch.inc" --&gt;
</p></blockquote>
<p>Some notes on this below, but here is the actual fetcher/cacher to put in <code>fetch.inc</code> and bring it in with the above:</p>
<blockquote class="code"><p>
&lt;%<br />
' @description remote calls to get livery<br />
'<br />
' @param strUrl might need to be Dim-defined in wrapping file<br />
' @param strUrlKey must be Dim-defined and set to a particular<br />
'   livery identifier in wrapping file  - also appends it to the URL<br />
'   query string that it gets<br />
' @returns HTML on standard output<br /><br />
strUrl = "<a href="http://example.com/?livery=">http://example.com/?livery=</a>" &amp; strUrlKey<br /><br />
' Cache timeout is 60 minutes<br />
' Application(foo) fails gracefully if key foo does not exist<br />
If DateDiff("n", Application(strUrl &amp; ".LastModified"), Now()) &gt;= 60 Then<br />
  ' If cache expired, get the page<br />
  Set objWinHttp = CreateObject("Msxml2.ServerXMLHTTP")<br />
  ' Turn error handling on<br />
  On Error Resume Next<br /><br />
  ' Timeouts will now be handled<br />
  objWinHttp.open "GET", strUrl, False<br />
  objWinHttp.send<br /><br />
  ' If no error, trust content<br />
  If Err.number = 0 Then<br />
    ' Lock the application scope and insert page and cache date<br />
    Application.Lock()<br />
    Application(strUrlKey) = objWinHttp.responseText<br />
    Application(strUrlKey &amp; ".LastModified") = Now()<br />
    Application.UnLock()<br />
  End If<br /><br />
  ' Turn error handling off<br />
  On Error Goto 0<br /><br />
End If<br /><br />
' Regardless, read from the application<br />
Response.Write(Application(strUrlKey))<br /><br />
' Tear down object<br />
Set objWinHttp = Nothing<br />
%&gt;</p></blockquote>
<p>The <code>Dim</code> statements before the <code>&lt;!--include--&gt;</code> make it all a real pain in the arse. Some server configurations will arbitrarily interpret and run ASP files without <code>Dim</code>s; some won't. And you can only ever <code>Dim</code> a variable once in a particular variable scope, or everything dies horribly; you have to keep track of whether or not a variable has already been declared, pretty much <em>by eye</em>.</p>
<p>Depending on your server, you might also not have access to the particular DLL that provides <code>Msxml2.ServerXMLHTTP</code>. If that's the case, then there are other possible ways of making the HTTP call out there on the web: it's just that the Graceful Exits bouncer isn't letting them through the door.</p>
<p>Now, if you'll excuse me, I need a shower.</p>
</div></div></div><div id="comments" class="comment-wrapper">
          <h2 class="title">Comments</h2>
      
  <a id="comment-93"></a>
<div class="comment comment-by-anonymous clearfix">

  <div class="attribution">

    
    <div class="submitted">
      <p class="commenter-name">
        <span class="username">David (not verified)</span>      </p>
      <p class="comment-time">
        Tue, 23/09/2008 - 12:24      </p>
      <p class="comment-permalink">
        <a href="93.html#comment-93" class="permalink" rel="bookmark">Permalink</a>      </p>
    </div>
  </div>

  <div class="comment-text">
    <div class="comment-arrow"></div>

    
    <div style='display: none;'>    <h3><a href="93.html#comment-93" class="permalink" rel="bookmark">Erm, you declare &quot;strKey&quot; but</a></h3>
    </div>
    <div class="content">
      <div class="field field-name-comment-body field-type-text-long field-label-hidden"><div class="field-items"><div class="field-item even"><p>Erm, you declare "strKey" but don't use it, and assign to strUrlEnd, but appear to be using strUrlKey, have you been searching and replacing without recompiling?</p>
</div></div></div>          </div> <!-- /.content -->

      </div> <!-- /.comment-text -->
</div>
<a id="comment-94"></a>
<div class="comment comment-by-anonymous clearfix">

  <div class="attribution">

    
    <div class="submitted">
      <p class="commenter-name">
        <a href="/" rel="nofollow" class="username.html">jps (not verified)</a>      </p>
      <p class="comment-time">
        Tue, 23/09/2008 - 12:47      </p>
      <p class="comment-permalink">
        <a href="94.html#comment-94" class="permalink" rel="bookmark">Permalink</a>      </p>
    </div>
  </div>

  <div class="comment-text">
    <div class="comment-arrow"></div>

    
    <div style='display: none;'>    <h3><a href="94.html#comment-94" class="permalink" rel="bookmark">Well, mostly I&#039;m confusing</a></h3>
    </div>
    <div class="content">
      <div class="field field-name-comment-body field-type-text-long field-label-hidden"><div class="field-items"><div class="field-item even"><p>Well, mostly I'm confusing sanitized code with an unmodified snippet to invoke it, as I added the invocation snippet to this post at the last minute. Should all be consistent now.</p>
<p>(I certainly haven't been able to <em>test</em> the sanitized version, if that's what you mean: it goes entirely against the grain, certainly; but it's impossible for various reasons that I'll tell you about later.)</p>
</div></div></div>          </div> <!-- /.content -->

      </div> <!-- /.comment-text -->
</div>

  </div>
</div>

  </div>
</div>
  </div>
      
    </div></div> <!-- /.section, /#content -->

          <div id="sidebar-second" class="column sidebar"><div class="section">
          <div class="region region-sidebar-second">
    <div id="block-block-7" class="block block-block">

    <h2>I&#039;m a Drupal Association member!</h2>
  
  <div class="content">
    <div style="margin: -15px 0"><a href="https://drupal.org/user/130486"><img src="https://association.drupal.org/files/Drupal_Association_ind_member_217_0.png" alt="My individual membership of the Drupal Association" title="You can view my DA membership on drupal.org" width="168" height="168" /></a></div>
  </div>
</div>
<div id="block-block-10" class="block block-block">

    <h2>Drupal 8 API tutorials</h2>
  
  <div class="content">
    <p>Want to learn about the Drupal 8 APIs, with worked examples? <a href="/d8api.html">Follow my series of tutorials</a>, covering routing, caching, entities, config and much more!</p>
  </div>
</div>
<div id="block-stateblock-stateblock" class="block block-stateblock">

    <h2>Want to hire me?</h2>
  
  <div class="content">
    <a href="../contact.html"><section class="state-no">
  <header>I'm currently</header>
  <section class="state-description">fully booked</section>
  <footer>for freelance work. But you can click here to contact me!</footer>
</section></a>  </div>
</div>
<div id="block-ds-extras-blogpost-secondary-nav" class="block block-ds-extras">

    
  <div class="content">
    <div class="field field-name-taxonomy-vocabulary-6 field-type-taxonomy-term-reference field-label-above clearfix"><h3 class="field-label">Blog category: </h3><ul class="links"><li class="taxonomy-term-reference-0"><a href="../category/wordpress-category/enterprise.html">enterprise</a>, <a href="../category/wordpress-category/quickies.html">quickies</a>, <a href="../category/wordpress-category/software.html">software</a></li></ul></div><div class="field field-name-taxonomy-vocabulary-7 field-type-taxonomy-term-reference field-label-above clearfix"><h3 class="field-label">Tags: </h3><ul class="links"><li class="taxonomy-term-reference-0"><a href="../category/wordpress-tag/cache.html">cache</a>, <a href="../category/wordpress-tag/http.html">http</a>, <a href="../category/wordpress-tag/dotnet.html">dotnet</a>, <a href="../category/wordpress-tag/net.html">.net</a>, <a href="../category/wordpress-tag/application.html">application</a>, <a href="../category/wordpress-tag/asp.html">asp</a>, <a href="../category/wordpress-tag/aspx.html">aspx</a>, <a href="../category/wordpress-tag/msxml2.html">msxml2</a>, <a href="../category/wordpress-tag/serverxmlhttp.html">serverxmlhttp</a>, <a href="../category/wordpress-tag/vbscript.html">vbscript</a></li></ul></div>  </div>
</div>
<div id="block-views-recent-blog-block-1" class="block block-views">

    <h2>Recent blogposts</h2>
  
  <div class="content">
    <div class="view view-recent-blog view-id-recent_blog view-display-id-block_1 view-dom-id-7f3f1574265d8fff2bb5d0190b1db127">
        
  
  
      <div class="view-content">
        <ul>
    <li class="first odd">
      
      <h3>
  
    
      <a href="../blog/2017-07-21/altering-length-drupal-8-text-field-contains-data.html">Altering the length of a Drupal 8 text field that contains data</a>
      </h3>
  

      <div>
  
    
      Friday, July 21, 2017 - 11:31
      </div>
  
    </li>
      <li class="even">
      
      <h3>
  
    
      <a href="../blog/2017-06-02/menagerie-testing-behavioural-unit-system-smoke-regression-oh-my.html">A menagerie of testing: behavioural, unit, system, smoke, regression, oh my!</a>
      </h3>
  

      <div>
  
    
      Friday, June 2, 2017 - 10:11
      </div>
  
    </li>
      <li class="last odd">
      
      <h3>
  
    
      <a href="../blog/2017-05-30/including-javascript-behat-tests-all-inside-headless-virtual-machine.html">Including Javascript in Behat tests, all inside a headless, virtual machine</a>
      </h3>
  

      <div>
  
    
      Tuesday, May 30, 2017 - 16:51
      </div>
  
    </li>
    </ul>
    </div>
  
  
  
      
<div class="more-link">
  <a href="../blog_view.html">
    All blogposts  </a>
</div>
  
  
  
</div>  </div>
</div>
<div id="block-block-5" class="block block-block">

    <h2>About me</h2>
  
  <div class="content">
    <p>I'm J-P Stacey, and I'm a freelance technical developer and software architect, working with <a href="http://drupal.org/">Drupal</a>, Javascript, Symfony, PHP and devops, with experience in project and process management and an emphasis on usability.</p>
<p>I live in the <a href="http://gov.uk">UK</a>; my website is self-hosted on <a href="http://bigv.io">bigv.io</a>; my email is hosted by <a href="http://mail.google.com">Google</a>, and that's also what I use to share files. <small>(<a href="https://data-jurisdiction.org/country/GB">More info</a>|<a href="/blog/2013-08-20/what-jurisdiction-am-i-in.html">What is this?</a>)</small></p>
  </div>
</div>
<div id="block-menu-secondary-menu" class="block block-menu">

    <h2>Find me elsewhere</h2>
  
  <div class="content">
    <ul class="menu clearfix"><li class="first leaf"><a href="http://twitter.com/mphield" title="My commercial account on Twitter">Company @ Twitter</a></li>
<li class="leaf"><a href="http://drupal.org/user/130486" title="Drupal user #130486: woohoo!">Drupal @ d.o</a></li>
<li class="leaf"><a href="http://github.com/jpstacey" title="My code repositories on Github">Code @ Github</a></li>
<li class="leaf"><a href="http://flickr.com/photos/eustatius" title="My photos on Flickr">Photos @ Flickr</a></li>
<li class="last leaf"><a href="http://pinboard.in/u:jpstacey" title="My links on the Pinboard bookmarking site">Links @ Pinboard</a></li>
</ul>  </div>
</div>
  </div>
      </div></div> <!-- /.section, /#sidebar-second -->
    
  </div></div> <!-- /#main, /#main-wrapper -->

  
  <div id="footer-wrapper"><div class="section">

    
    
  </div></div> <!-- /.section, /#footer-wrapper -->

</div></div> <!-- /#page, /#page-wrapper -->
  </body>
</html>
