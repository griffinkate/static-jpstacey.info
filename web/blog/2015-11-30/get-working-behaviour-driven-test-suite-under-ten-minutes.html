<!DOCTYPE html>
<html lang="en" version="XHTML+RDFa 1.0" dir="ltr">
<head profile="http://www.w3.org/1999/xhtml/vocab">
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="../../sites/files/jps/starberry_favicon.png" type="image/png" />
<meta name="generator" content="Drupal 7 (https://www.drupal.org)" />
<link rel="canonical" href="get-working-behaviour-driven-test-suite-under-ten-minutes.html" />
<link rel="shortlink" href="../../node/617.html" />
  <title>Get a working behaviour-driven test suite in under ten minutes | J-P Stacey</title>
  <link type="text/css" rel="stylesheet" href="../../sites/files/jps/css/css_xE-rWrJf-fncB6ztZfd2huxqgxu4WO-qwma6Xer30m4.css" media="all" />
<link type="text/css" rel="stylesheet" href="../../sites/files/jps/css/css_jdej_Zz2sjg--A2C2aVJ-Qt5W-fI_fkFnsddutilsws.css" media="all" />
<link type="text/css" rel="stylesheet" href="../../sites/files/jps/css/css_A3Qn9PgslsjDpW1HfgFuI26cQlhJ23E7y9wyYqpiJIA.css" media="all" />
<link type="text/css" rel="stylesheet" href="../../sites/files/jps/css/css_0Heb-O6YY5Tn5xG4WrHtAAXZCtYk-eKiVo7PlP1bsg4.css" media="all" />
<link type="text/css" rel="stylesheet" href="../../sites/files/jps/css/css_2THG1eGiBIizsWFeexsNe1iDifJ00QRS9uSd03rY9co.css" media="print" />

<!--[if lte IE 7]>
<link type="text/css" rel="stylesheet" href="/sites/default/themes/custom/barthes/css/ie.css?qfgo2z" media="all" />
<![endif]-->

<!--[if IE 6]>
<link type="text/css" rel="stylesheet" href="/sites/default/themes/custom/barthes/css/ie6.css?qfgo2z" media="all" />
<![endif]-->
  <script type="text/javascript" src="../../sites/files/jps/js/js_vDrW3Ry_4gtSYaLsh77lWhWjIC6ml2QNkcfvfP5CVFs.js"></script>
<script type="text/javascript" src="../../sites/files/jps/js/js_gPqjYq7fqdMzw8-29XWQIVoDSWTmZCGy9OqaHppNxuQ.js"></script>
<script type="text/javascript">
<!--//--><![CDATA[//><!--
(function(i,s,o,g,r,a,m){i["GoogleAnalyticsObject"]=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,"script","https://www.google-analytics.com/analytics.js","ga");ga("create", "UA-4775024-1", {"cookieDomain":"auto"});ga("set", "anonymizeIp", true);ga("send", "pageview");
//--><!]]>
</script>
<script type="text/javascript">
<!--//--><![CDATA[//><!--
jQuery.extend(Drupal.settings, {"basePath":"\/","pathPrefix":"","ajaxPageState":{"theme":"barthes","theme_token":"gq3O3COXOGvIZMF9ocluW9kVwmOG9upb9j7OGGA_Zvs","js":{"misc\/jquery.js":1,"misc\/jquery.once.js":1,"misc\/drupal.js":1,"sites\/all\/modules\/google_analytics\/googleanalytics.js":1,"0":1},"css":{"modules\/system\/system.base.css":1,"modules\/system\/system.menus.css":1,"modules\/system\/system.messages.css":1,"modules\/system\/system.theme.css":1,"modules\/comment\/comment.css":1,"sites\/all\/modules\/date\/date_api\/date.css":1,"sites\/all\/modules\/date\/date_popup\/themes\/datepicker.1.7.css":1,"modules\/field\/theme\/field.css":1,"sites\/all\/modules\/mollom\/mollom.css":1,"modules\/node\/node.css":1,"modules\/search\/search.css":1,"modules\/user\/user.css":1,"sites\/all\/modules\/views\/css\/views.css":1,"sites\/all\/modules\/media\/modules\/media_wysiwyg\/css\/media_wysiwyg.base.css":1,"sites\/all\/modules\/ctools\/css\/ctools.css":1,"public:\/\/geshi\/geshifilter-languages.css":1,"sites\/all\/modules\/geshifilter\/geshifilter.css":1,"themes\/bartik\/css\/layout.css":1,"themes\/bartik\/css\/style.css":1,"sites\/default\/themes\/custom\/barthes\/css\/colors.css":1,"sites\/default\/themes\/custom\/barthes\/css\/custom.css":1,"themes\/bartik\/css\/print.css":1,"sites\/default\/themes\/custom\/barthes\/css\/ie.css":1,"sites\/default\/themes\/custom\/barthes\/css\/ie6.css":1}},"googleanalytics":{"trackOutbound":1,"trackMailto":1,"trackDownload":1,"trackDownloadExtensions":"7z|aac|arc|arj|asf|asx|avi|bin|csv|doc(x|m)?|dot(x|m)?|exe|flv|gif|gz|gzip|hqx|jar|jpe?g|js|mp(2|3|4|e?g)|mov(ie)?|msi|msp|pdf|phps|png|ppt(x|m)?|pot(x|m)?|pps(x|m)?|ppam|sld(x|m)?|thmx|qtm?|ra(m|r)?|sea|sit|tar|tgz|torrent|txt|wav|wma|wmv|wpd|xls(x|m|b)?|xlt(x|m)|xlam|xml|z|zip"}});
//--><!]]>
</script>
</head>
<body class="html not-front not-logged-in one-sidebar sidebar-second page-node page-node- page-node-617 node-type-blog" >
  <div id="skip-link">
    <a href="get-working-behaviour-driven-test-suite-under-ten-minutes.html#main-content" class="element-invisible element-focusable">Skip to main content</a>
  </div>
    <div id="page-wrapper"><div id="page">

  <div id="header" class="with-secondary-menu"><div class="section clearfix">

    
          <div id="name-and-slogan">

                              <div id="site-name">
              <strong>
                <a href="../../index.html" title="Home" rel="home"><span>J-P Stacey</span></a>
              </strong>
            </div>
                  
                  <div id="site-slogan">
            Drupal, programming culture, gardening, cycling and the environment          </div>
        
      </div> <!-- /#name-and-slogan -->
    
    
    
          <div id="secondary-menu" class="navigation">
        <h2 class="element-invisible">Secondary menu</h2><ul id="secondary-menu-links" class="links inline clearfix"><li class="menu-7322 first"><a href="../../cv.html" title="My curriculum vitae">CV</a></li>
<li class="menu-7320 last"><a href="../../contact.html" title="">Contact me</a></li>
</ul>      </div> <!-- /#secondary-menu -->
    
  </div></div> <!-- /.section, /#header -->

  
  
  <div id="main-wrapper" class="clearfix"><div id="main" class="clearfix">

    
    
    <div id="content" class="column"><div class="section">
            <a id="main-content"></a>
                    <h1 class="title" id="page-title">
          Get a working behaviour-driven test suite in under ten minutes        </h1>
                          <div class="tabs">
                  </div>
                          <div class="region region-content">
    <div id="block-system-main" class="block block-system">

    
  <div class="content">
    <div  class="ds-1col node node-blog node-promoted node-full view-mode-full clearfix">

  
  <div class="field field-name-post-date field-type-ds field-label-hidden"><div class="field-items"><div class="field-item even">Monday, November 30, 2015 - 12:15</div></div></div><div class="field field-name-field-body field-type-text-long field-label-hidden"><div class="field-items"><div class="field-item even"><p>You should be developing using some kind of test harness: that way you know that what you're doing right now is unlikely to have broken what you did six days or six months ago. Better still, you know what you did six days or six months ago far more completely, because the tests fleshed out the specification at the time and provide a clear, documenting definition of the functionality for your current purposes.</p>
<p>But setting up tests, especially in behaviour-led and tightly-coupled systems like Drupal, is hard, right? Well, my recent experience on a project (more about that later) has taught me that not only is it absolutely worth setting up a <a href="https://blog.codeship.com/behavior-driven-development/2">behaviour-driven test suite</a>, but that doing so is really straightforward these days.</p>
<p>Here's how to set up Behat testing, and have an example test running, in under ten minutes. You can apply this tutorial to a new project, to a project in development, to a project under ongoing maintenance, and even to a non-PHP or non-Drupal project, and it will be worth it.</p>
<h2>Download Behat with the Drupal extension</h2>
<p>It's 2015 and this is a predominantly Drupal blog, so I'm going to assume you've got composer already installed. If you're not sure about that or anything below, there is <a href="https://behat-drupal-extension.readthedocs.org/en/3.1/localinstall.html">fuller documentation available</a>. (Other <a href="https://cucumber.io/2">non-PHP BDD frameworks</a> also exist, but I don't cover them here.)</p>
<p>To set up a Behat project which is fully Drupal-aware, first create a project folder. Everything that follows will be assumed to be happening within that folder, so if you're working at a terminal, <span class="geshifilter"><code class="text geshifilter-text">cd</code></span> into the folder before you run anything below.</p>
<p>Add a very simple <span class="geshifilter"><code class="text geshifilter-text">composer.json</code></span> file to this folder:</p>
<div class="geshifilter">
<pre class="javascript geshifilter-javascript" style="font-family:monospace;"><span class="br0">{</span>
  <span class="st0">"require"</span><span class="sy0">:</span> <span class="br0">{</span>
    <span class="st0">"drupal/drupal-extension"</span><span class="sy0">:</span> <span class="st0">"~3.0"</span>
<span class="br0">}</span><span class="sy0">,</span>
  <span class="st0">"config"</span><span class="sy0">:</span> <span class="br0">{</span>
    <span class="st0">"bin-dir"</span><span class="sy0">:</span> <span class="st0">"bin/"</span>
  <span class="br0">}</span>
<span class="br0">}</span></pre></div>
<p>From a terminal window, run <span class="geshifilter"><code class="text geshifilter-text">composer install</code></span>, and Behat should "just install", along with Mink and the Drupal extension.</p>
<h2>Initialize Behat and add a configuration YAML file</h2>
<p>Run <span class="geshifilter"><code class="text geshifilter-text">bin/behat --init</code></span> and it will set up a <span class="geshifilter"><code class="text geshifilter-text">features/</code></span> subfolder for you, with some stub PHP classes you can ignore for now.</p>
<p>Next, add a <span class="geshifilter"><code class="text geshifilter-text">behat.yml</code></span> file at the top level:</p>
<div class="geshifilter">
<pre class="text geshifilter-text" style="font-family:monospace;">default:
  suites:
    default:
      contexts:
        - FeatureContext
        - Drupal\DrupalExtension\Context\DrupalContext
        - Drupal\DrupalExtension\Context\MinkContext
        - Drupal\DrupalExtension\Context\MessageContext
        - Drupal\DrupalExtension\Context\DrushContext
  extensions:
    Behat\MinkExtension:
      goutte: ~
      selenium2: ~
      base_url: http://www.google.co.uk
    Drupal\DrupalExtension:
      blackbox: ~</pre></div>
<p>This looks like a lot of detail, but don't panic: most of this is boilerplate from the more in-depth documentation I linked to above. The only thing you need to worry about for the purposes of this tutorial is the <span class="geshifilter"><code class="text geshifilter-text">base_url:</code></span> parameter.</p>
<p>We set it to a Google address, to make the test below work. You can do that too, initially, but you'll want to test your local build eventually instead.</p>
<h2>Add your first test</h2>
<p>Within the <span class="geshifilter"><code class="text geshifilter-text">features/</code></span> subfolder that was created by the <span class="geshifilter"><code class="text geshifilter-text">--init</code></span> step above, add the following as a file <span class="geshifilter"><code class="text geshifilter-text">features/navigate.feature</code></span>:</p>
<div class="geshifilter">
<pre class="text geshifilter-text" style="font-family:monospace;">Feature: Navigate website.
  In order to begin working with my website
  As a site visitor
  I need to be able to navigate around the site
 
  Scenario: Access advanced search
    Given I am on the homepage
    When I click "Advanced search"
    Then I should see "all these words:" in the "label[for=_dKg]" element
    And I should see the text "Put exact words in quotes"</pre></div>
<p>Pause for a moment to marvel at the Gherkin BDD test syntax: which means I don't have to explain what the test above does; but also means that the test above is already pretty powerful (and you haven't had to write a single line of code to leverage that power!)</p>
<h2>Run!</h2>
<p>Wait, come back! I mean, run your new test: just run <span class="geshifilter"><code class="text geshifilter-text">bin/behat</code></span>. You should see the following output:</p>
<div class="geshifilter">
<pre class="text geshifilter-text" style="font-family:monospace;">Feature: Navigate website.
  In order to begin working with my website
  As a site visitor
  I need to be able to navigate around the site
 
  Scenario: Access advanced search                                        # features/navigate.feature:6
    Given I am on the homepage                                            # Drupal\DrupalExtension\Context\MinkContext::iAmOnHomepage()
    When I click "Advanced search"                                        # Drupal\DrupalExtension\Context\MinkContext::assertClick()
    Then I should see "all these words:" in the "label[for=_dKg]" element # Drupal\DrupalExtension\Context\MinkContext::assertElementContainsText()
    And I should see the text "Put exact words in quotes"                 # Drupal\DrupalExtension\Context\MinkContext::assertTextVisible()
 
1 scenario (1 passed)
4 steps (4 passed)
0m0.77s (17.98Mb)</pre></div>
<p>It's a kind of annotated version of your original Gherkin feature, telling you which PHP methods were invoked to correspond to (and therefore handle) each pseudo-English assertion.</p>
<h2>You're done!</h2>
<p>Actually, in testing, you're never done. You should write more tests for your site! Think of things your users or visitors need to do—especially bottom-line things, like logging in, donating or purchasing—and write tests for them. Then get those tests to run! Then write more tests, as you roll out new functionality. And if you're feeling particularly brave, you should write more tests <em>before</em> you even begin new functionality: watch the tests fail, then write the functionality to make them pass, then... actually make them pass.</p>
<p>You <em>can</em> (and should) retrofit a test suite like this to an existing project with no tests. But next time you're thinking of starting a new project, ask yourself the question: can I spare ten minutes to start writing tests from the very beginning? I think we know what the answer ought to be!</p>
</div></div></div><div id="comments" class="comment-wrapper">
          <h2 class="title">Comments</h2>
      
  <a id="comment-270"></a>
<div class="comment comment-by-anonymous clearfix">

  <div class="attribution">

    
    <div class="submitted">
      <p class="commenter-name">
        <a href="http://behavedrupal.com" rel="nofollow" class="username">Unnikrishnan Bh... (not verified)</a>      </p>
      <p class="comment-time">
        Fri, 21/10/2016 - 14:47      </p>
      <p class="comment-permalink">
        <a href="../../comment/270.html#comment-270" class="permalink" rel="bookmark">Permalink</a>      </p>
    </div>
  </div>

  <div class="comment-text">
    <div class="comment-arrow"></div>

    
    <div style='display: none;'>    <h3><a href="../../comment/270.html#comment-270" class="permalink" rel="bookmark">I have developed and IDE for</a></h3>
    </div>
    <div class="content">
      <div class="field field-name-comment-body field-type-text-long field-label-hidden"><div class="field-items"><div class="field-item even"><p>I have developed and IDE for make behaviour testing easy with Drupal, you can check it here: <a href="http://behavedrupal.com/ide.html">http://behavedrupal.com/ide.html</a> It is opensource you can find the code here: <a href="https://github.com/UnnikrishnanBhargavakur">https://github.com/UnnikrishnanBhargavakur</a>,  Please make a look and add you feedbacks:</p>
<p><a href="http://behavedrupal.com">http://behavedrupal.com</a></p>
<p>Please delete this comment if it is not relevant here</p>
</div></div></div>          </div> <!-- /.content -->

    <ul class="links inline"><li class="comment-reply first last"><a href="../../comment/reply/617/270.html">reply</a></li>
</ul>  </div> <!-- /.comment-text -->
</div>

  </div>
</div>

  </div>
</div>
  </div>
      
    </div></div> <!-- /.section, /#content -->

          <div id="sidebar-second" class="column sidebar"><div class="section">
          <div class="region region-sidebar-second">
    <div id="block-block-7" class="block block-block">

    <h2>I&#039;m a Drupal Association member!</h2>
  
  <div class="content">
    <div style="margin: -15px 0"><a href="https://drupal.org/user/130486"><img src="https://association.drupal.org/files/Drupal_Association_ind_member_217_0.png" alt="My individual membership of the Drupal Association" title="You can view my DA membership on drupal.org" width="168" height="168" /></a></div>
  </div>
</div>
<div id="block-block-10" class="block block-block">

    <h2>Drupal 8 API tutorials</h2>
  
  <div class="content">
    <p>Want to learn about the Drupal 8 APIs, with worked examples? <a href="/d8api.html">Follow my series of tutorials</a>, covering routing, caching, entities, config and much more!</p>
  </div>
</div>
<div id="block-stateblock-stateblock" class="block block-stateblock">

    <h2>Want to hire me?</h2>
  
  <div class="content">
    <a href="../../contact.html"><section class="state-no">
  <header>I'm currently</header>
  <section class="state-description">fully booked</section>
  <footer>for freelance work. But you can click here to contact me!</footer>
</section></a>  </div>
</div>
<div id="block-ds-extras-blogpost-secondary-nav" class="block block-ds-extras">

    
  <div class="content">
    <div class="field field-name-taxonomy-vocabulary-6 field-type-taxonomy-term-reference field-label-above clearfix"><h3 class="field-label">Blog category: </h3><ul class="links"><li class="taxonomy-term-reference-0"><a href="../../category/wordpress-category/framework.html">framework</a>, <a href="../../category/wordpress-category/quickies.html">quickies</a>, <a href="../../category/wordpress-category/tutorials.html">tutorials</a></li></ul></div><div class="field field-name-taxonomy-vocabulary-7 field-type-taxonomy-term-reference field-label-above clearfix"><h3 class="field-label">Tags: </h3><ul class="links"><li class="taxonomy-term-reference-0"><a href="../../category/tags/bdd.html">bdd</a>, <a href="../../category/wordpress-tag/testing.html">testing</a>, <a href="../../category/tags/behat.html">behat</a></li></ul></div>  </div>
</div>
<div id="block-views-recent-blog-block-1" class="block block-views">

    <h2>Recent blogposts</h2>
  
  <div class="content">
    <div class="view view-recent-blog view-id-recent_blog view-display-id-block_1 view-dom-id-e45137c2b053c93fa5e603d3485df53c">
        
  
  
      <div class="view-content">
        <ul>
    <li class="first odd">
      
      <h3>
  
    
      <a href="../2017-07-21/altering-length-drupal-8-text-field-contains-data.html">Altering the length of a Drupal 8 text field that contains data</a>
      </h3>
  

      <div>
  
    
      Friday, July 21, 2017 - 11:31
      </div>
  
    </li>
      <li class="even">
      
      <h3>
  
    
      <a href="../2017-06-02/menagerie-testing-behavioural-unit-system-smoke-regression-oh-my.html">A menagerie of testing: behavioural, unit, system, smoke, regression, oh my!</a>
      </h3>
  

      <div>
  
    
      Friday, June 2, 2017 - 10:11
      </div>
  
    </li>
      <li class="last odd">
      
      <h3>
  
    
      <a href="../2017-05-30/including-javascript-behat-tests-all-inside-headless-virtual-machine.html">Including Javascript in Behat tests, all inside a headless, virtual machine</a>
      </h3>
  

      <div>
  
    
      Tuesday, May 30, 2017 - 16:51
      </div>
  
    </li>
    </ul>
    </div>
  
  
  
      
<div class="more-link">
  <a href="../../blog_view.html">
    All blogposts  </a>
</div>
  
  
  
</div>  </div>
</div>
<div id="block-block-5" class="block block-block">

    <h2>About me</h2>
  
  <div class="content">
    <p>I'm J-P Stacey, and I'm a freelance technical developer and software architect, working with <a href="http://drupal.org/">Drupal</a>, Javascript, Symfony, PHP and devops, with experience in project and process management and an emphasis on usability.</p>
<p>I live in the <a href="http://gov.uk">UK</a>; my website is self-hosted on <a href="http://bigv.io">bigv.io</a>; my email is hosted by <a href="http://mail.google.com">Google</a>, and that's also what I use to share files. <small>(<a href="https://data-jurisdiction.org/country/GB">More info</a>|<a href="/blog/2013-08-20/what-jurisdiction-am-i-in.html">What is this?</a>)</small></p>
  </div>
</div>
<div id="block-menu-secondary-menu" class="block block-menu">

    <h2>Find me elsewhere</h2>
  
  <div class="content">
    <ul class="menu clearfix"><li class="first leaf"><a href="http://twitter.com/mphield" title="My commercial account on Twitter">Company @ Twitter</a></li>
<li class="leaf"><a href="http://drupal.org/user/130486" title="Drupal user #130486: woohoo!">Drupal @ d.o</a></li>
<li class="leaf"><a href="http://github.com/jpstacey" title="My code repositories on Github">Code @ Github</a></li>
<li class="leaf"><a href="http://flickr.com/photos/eustatius" title="My photos on Flickr">Photos @ Flickr</a></li>
<li class="last leaf"><a href="http://pinboard.in/u:jpstacey" title="My links on the Pinboard bookmarking site">Links @ Pinboard</a></li>
</ul>  </div>
</div>
  </div>
      </div></div> <!-- /.section, /#sidebar-second -->
    
  </div></div> <!-- /#main, /#main-wrapper -->

  
  <div id="footer-wrapper"><div class="section">

    
    
  </div></div> <!-- /.section, /#footer-wrapper -->

</div></div> <!-- /#page, /#page-wrapper -->
  </body>
</html>
