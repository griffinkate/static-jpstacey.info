<!DOCTYPE html>
<html lang="en" version="XHTML+RDFa 1.0" dir="ltr">
<head profile="http://www.w3.org/1999/xhtml/vocab">
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="../sites/files/jps/starberry_favicon.png" type="image/png" />
<meta name="generator" content="Drupal 7 (https://www.drupal.org)" />
<link rel="canonical" href="../blog/2013-10-01/why-you-might-not-be-using-drush-make.html" />
<link rel="shortlink" href="474.html" />
  <title>Why you might not be using Drush make | J-P Stacey</title>
  <link type="text/css" rel="stylesheet" href="../sites/files/jps/css/css_xE-rWrJf-fncB6ztZfd2huxqgxu4WO-qwma6Xer30m4.css" media="all" />
<link type="text/css" rel="stylesheet" href="../sites/files/jps/css/css_jdej_Zz2sjg--A2C2aVJ-Qt5W-fI_fkFnsddutilsws.css" media="all" />
<link type="text/css" rel="stylesheet" href="../sites/files/jps/css/css_A3Qn9PgslsjDpW1HfgFuI26cQlhJ23E7y9wyYqpiJIA.css" media="all" />
<link type="text/css" rel="stylesheet" href="../sites/files/jps/css/css_0Heb-O6YY5Tn5xG4WrHtAAXZCtYk-eKiVo7PlP1bsg4.css" media="all" />
<link type="text/css" rel="stylesheet" href="../sites/files/jps/css/css_2THG1eGiBIizsWFeexsNe1iDifJ00QRS9uSd03rY9co.css" media="print" />

<!--[if lte IE 7]>
<link type="text/css" rel="stylesheet" href="http://jpstacey.lndo.site/sites/default/themes/custom/barthes/css/ie.css?qfgo2z" media="all" />
<![endif]-->

<!--[if IE 6]>
<link type="text/css" rel="stylesheet" href="http://jpstacey.lndo.site/sites/default/themes/custom/barthes/css/ie6.css?qfgo2z" media="all" />
<![endif]-->
  <script type="text/javascript" src="../sites/files/jps/js/js_vDrW3Ry_4gtSYaLsh77lWhWjIC6ml2QNkcfvfP5CVFs.js"></script>
<script type="text/javascript" src="../sites/files/jps/js/js_gPqjYq7fqdMzw8-29XWQIVoDSWTmZCGy9OqaHppNxuQ.js"></script>
<script type="text/javascript">
<!--//--><![CDATA[//><!--
(function(i,s,o,g,r,a,m){i["GoogleAnalyticsObject"]=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,"script","https://www.google-analytics.com/analytics.js","ga");ga("create", "UA-4775024-1", {"cookieDomain":"auto"});ga("set", "anonymizeIp", true);ga("send", "pageview");
//--><!]]>
</script>
<script type="text/javascript">
<!--//--><![CDATA[//><!--
jQuery.extend(Drupal.settings, {"basePath":"\/","pathPrefix":"","ajaxPageState":{"theme":"barthes","theme_token":"qQrbdL5sOg8IxLCA0dZc9HNeuryWucHRWVgVcMxgPr8","js":{"misc\/jquery.js":1,"misc\/jquery.once.js":1,"misc\/drupal.js":1,"sites\/all\/modules\/google_analytics\/googleanalytics.js":1,"0":1},"css":{"modules\/system\/system.base.css":1,"modules\/system\/system.menus.css":1,"modules\/system\/system.messages.css":1,"modules\/system\/system.theme.css":1,"modules\/comment\/comment.css":1,"sites\/all\/modules\/date\/date_api\/date.css":1,"sites\/all\/modules\/date\/date_popup\/themes\/datepicker.1.7.css":1,"modules\/field\/theme\/field.css":1,"sites\/all\/modules\/mollom\/mollom.css":1,"modules\/node\/node.css":1,"modules\/search\/search.css":1,"modules\/user\/user.css":1,"sites\/all\/modules\/views\/css\/views.css":1,"sites\/all\/modules\/media\/modules\/media_wysiwyg\/css\/media_wysiwyg.base.css":1,"sites\/all\/modules\/ctools\/css\/ctools.css":1,"public:\/\/geshi\/geshifilter-languages.css":1,"sites\/all\/modules\/geshifilter\/geshifilter.css":1,"themes\/bartik\/css\/layout.css":1,"themes\/bartik\/css\/style.css":1,"sites\/default\/themes\/custom\/barthes\/css\/colors.css":1,"sites\/default\/themes\/custom\/barthes\/css\/custom.css":1,"themes\/bartik\/css\/print.css":1,"sites\/default\/themes\/custom\/barthes\/css\/ie.css":1,"sites\/default\/themes\/custom\/barthes\/css\/ie6.css":1}},"googleanalytics":{"trackOutbound":1,"trackMailto":1,"trackDownload":1,"trackDownloadExtensions":"7z|aac|arc|arj|asf|asx|avi|bin|csv|doc(x|m)?|dot(x|m)?|exe|flv|gif|gz|gzip|hqx|jar|jpe?g|js|mp(2|3|4|e?g)|mov(ie)?|msi|msp|pdf|phps|png|ppt(x|m)?|pot(x|m)?|pps(x|m)?|ppam|sld(x|m)?|thmx|qtm?|ra(m|r)?|sea|sit|tar|tgz|torrent|txt|wav|wma|wmv|wpd|xls(x|m|b)?|xlt(x|m)|xlam|xml|z|zip"}});
//--><!]]>
</script>
</head>
<body class="html not-front not-logged-in one-sidebar sidebar-second page-node page-node- page-node-474 node-type-blog" >
  <div id="skip-link">
    <a href="474.html#main-content" class="element-invisible element-focusable">Skip to main content</a>
  </div>
    <div id="page-wrapper"><div id="page">

  <div id="header" class="with-secondary-menu"><div class="section clearfix">

    
          <div id="name-and-slogan">

                              <div id="site-name">
              <strong>
                <a href="../index.html" title="Home" rel="home"><span>J-P Stacey</span></a>
              </strong>
            </div>
                  
                  <div id="site-slogan">
            Drupal, programming culture, gardening, cycling and the environment          </div>
        
      </div> <!-- /#name-and-slogan -->
    
    
    
          <div id="secondary-menu" class="navigation">
        <h2 class="element-invisible">Secondary menu</h2><ul id="secondary-menu-links" class="links inline clearfix"><li class="menu-7322 first"><a href="../cv.html" title="My curriculum vitae">CV</a></li>
<li class="menu-7320 last"><a href="../contact.html" title="">Contact me</a></li>
</ul>      </div> <!-- /#secondary-menu -->
    
  </div></div> <!-- /.section, /#header -->

  
  
  <div id="main-wrapper" class="clearfix"><div id="main" class="clearfix">

    
    
    <div id="content" class="column"><div class="section">
            <a id="main-content"></a>
                    <h1 class="title" id="page-title">
          Why you might not be using Drush make        </h1>
                          <div class="tabs">
                  </div>
                          <div class="region region-content">
    <div id="block-system-main" class="block block-system">

    
  <div class="content">
    <div  class="ds-1col node node-blog node-promoted node-full view-mode-full clearfix">

  
  <div class="field field-name-post-date field-type-ds field-label-hidden"><div class="field-items"><div class="field-item even">Tuesday, October 1, 2013 - 20:40</div></div></div><div class="field field-name-field-body field-type-text-long field-label-hidden"><div class="field-items"><div class="field-item even"><p>In a previous blogpost, I detailed lots of reasons why <a href="/blog/2013-09-18/why-you-should-be-using-drush-make.html">you should be using Drush make</a>. If it were that good, you might reply, then why isn't <em>everyone</em> already using it?</p>
<p>While the advantages of Drush make are in many ways immediately clear - you can watch it run and work - the disadvantages often appear when you start trying to use it. After the hype, the discovery of hidden problems can be pretty demoralizing. Drupal's own Dries Buytaert has applied the idea of <a>Gartner's Hype Cycle to Drupal core</a>; and that very emotional process of excitement and then disillusionment can happen in miniature, with each person's impressions of any software: including, of course, Drush make.</p>
<p>Below are some of the most likely reasons why you might have got disillusioned with Drush make, and some suggestions for how the underlying problems can be mitigated.</p>
<h2>1. Fitting into an existing workflow</h2>
<p>This is the immediate barrier I see to people using Drush make. Typically, your development, staging and (re-)deployment workflows will be oriented around something other than Drush make. Most likely, you'll be using the One Big Repository method, forking contributed code and putting it into your own bucket. But I've heard of people even doing things like building RPMs for (re-)deployment on a RedHat server: it takes all sorts.</p>
<p>As there are a lot of non-make solutions out there to the problem of "how do I build a site", then if you're looking at embedding Drush make into that existing workflow, the key really is to see what scripting you've already done, and then identify where it can be injected. Typically there will be a single point, where you would usually e.g. fetch changes, where you can run drush make instead. This might be run on your production server; it might be run when you build some kind of package (if that's what you're doing!)</p>
<p>If you're already committed to One Big Repository, you could try <strong>drush generate-makefile</strong>. This will generate a makefile from your existing site, referencing drupal.org projects wherever possible. You can use the excellent <a href="https://drupal.org/project/hacked">hacked module</a> to determine which of these contributed modules have been (sometimes unintentionally) edited; anything that could usefully be submitted as patches on issue queues, you can do so by running hacked plus the <a href="https://drupal.org/project/diff">diff module</a>, which will even pin down exactly what changes you've made and represent them in diff/patch file format. If you're left with only a handful of remaining custom projects, consider hosting them as separate git repositories; and you're almost done!</p>
<p>There will always be some (re-)deployment methods that don't really suit having to execute and then re-execute Drush make whenever you're doing a major contributed-project update: <a href="http://danbarber.me/using-git-for-deployment/">git-only deployment </a>springs to mind; but unless you're really wedded to that (re-)deployment method - and it's worth looking critically at it before you say you are - then you should consider switching to a method that can incorporate Drush make.</p>
<h2>2. Speed of building a codebase from downloaded parts</h2>
<p>If you have to download every project from drupal.org, every time, then the speed of your build process might suffer. That "pseudo-compression" factor I mentioned in my previous blogpost - version-controlling a single line rather than a megabyte of module code - only really makes sense when you think of the size of e.g. your git repository, or the code you need to pass to another developer or keep in your own head, if you're experimenting with a build.</p>
<p>At Torchbox, we've historically mitigated most of the download problems at our network gateway, with a squid proxy on the gateway router cacheing any traffic that looks like a Drupal module zipfile. In addition, later versions of Drush maintain their own internal cache of downloaded modules; even so, having a gateway proxy cache means that one developer's downloads will automatically be available for any other developer until the cache expires. </p>
<p>However, it's true that, generally speaking, download speed must always be a consideration when building a codebase via Drush make, and you should definitely have contingency plans in place. If drupal.org is down, and your local copies of modules are not entirely complete, then as things stand your (re-)deployment procedure might have to wait, or worked around on live by downloading individual module changes into the codebase.</p>
<h2>3. Drush make only does the bare minimum</h2>
<p>What Drush make actually does is only the bare bones of a site: which is fine for a build, but less suitable for <em>re</em>building an existing site. At that point, the "codebase" includes such customizations as a local settings.php file, the contents of Drupal's files folder, any client-specific themes and modules - if they're all in one git repository at sites/default - and occasionally even random custom folders or files at the root folder (a hard habit for some site maintainers to break!)</p>
<p>Despite the fact that most sites will contain at least one of these non-contributed components, Drush limits itself to: core, d.o-hosted projects, libraries, and projects hosted elsewhere using e.g. git; it's up to you to set up the rest. Where do your uploaded files go? What if you needed to apply symlinks? What if you've uploaded some custom top-level file for some temporary campaign or similar? And what about when you need to somehow put your newly built codebase in place of the old codebase, without any loss of service of either your static files (maybe still in the old codebase) or your new code (probably not yet at the correct webroot)?</p>
<p>The answer from Drush make, at any rate, is a - not unfriendly - shrug: it simply doesn't concern itself with these problems, and leaves the solutions up to the developer. But I think that this lack of functionality is the main reason that most people abandon Drush make after the initial site build. Indeed, whereas Drush make powers d.o's building of Drupal distributions from install profiles; yet, once built, downloaded and installed, people rarely see the usefulness in continuing to use Drush make to redeploy it and bring in updates: they understandably ask "where's the process for doing that?" and find none available.</p>
<p>Any larger software house that wants to persist with  builds a larger framework to sit Drush make into. After all, once the problem is identified, such a "framework" need only be a few command-line scripts for moving files and folders around. I've even known companies build this kind of solution out of C#, as this was the in-house language of choice that pre-dated Drupal adoption. I've been involved in building three now - two of which were proprietary, in Bash and Python - and the third is set to be a native Drush command project, <a href="https://drupal.org/project/drush_instance">already available</a> in an unstable alpha on d.o, under the GPL. More on that in a later blogpost; but if you want to use Drush make to maintain your codebases, expect to introduce at least some scripting, whether your own or someone else's.</p>
<h2>How you can work around these problems</h2>
<p>Each of the problems above needs consideration, if you want to make substantial, ongoing use of Drush make (and like I've said previously, there are definite advantages to doing so.) Right now I would say the most obvious solutions are:</p>
<ol><li><strong>Fitting into an existing workflow</strong>. Use <strong>drush generate-makefile</strong>, and identify the point in your workflow scripting where you can neatly insert a <strong>drush make</strong>.</li>
<li><strong>Speed of building a codebase from downloaded parts.</strong> Ensure you have a version of Drush that caches locally; consider a local squid proxy for all <strong>drush dl</strong> traffic; or even a local mirror of the zipfiles. Have an agreed contingency plan for when code is not easily available, even if it's "wait."</li>
<li><strong>Drush make only does the bare minimum.</strong> Script your full build process, or consider using something like <a>Drush instance</a>, which is basically the same thing.</li>
</ol><p>As you can see, it's not going to be a one-click install. But you can introduce each of these fixes as and when you find that a particular aspect of Drush make is starting to get on your nerves. It's just best that you're aware of the problems in advance, and aware that others feel your pain!</p>
<h2>Pain? so is Drush make really worth it?</h2>
<p>Oh, yes. I definitely think it's worth using Drush make. In the absence of (among other things) good HTTP patching support in php-composer, it's a very elegant, targeted solution to a specific problem that arises when you're building a site from many contributed sources, mostly available from the same place. And I've built, or helped build, around a dozen sites with a Drush make build workflow, and it's a huge improvement on the One Big Git Repository approach we used to follow, especially where maintenance is concerned.</p>
<p>Seriously. Try using Drush make for your deployments. You'll never look back. It'll change your life. No pain, no gain. Right?</p>
</div></div></div></div>

  </div>
</div>
  </div>
      
    </div></div> <!-- /.section, /#content -->

          <div id="sidebar-second" class="column sidebar"><div class="section">
          <div class="region region-sidebar-second">
    <div id="block-block-7" class="block block-block">

    <h2>I&#039;m a Drupal Association member!</h2>
  
  <div class="content">
    <div style="margin: -15px 0"><a href="https://drupal.org/user/130486"><img src="https://association.drupal.org/files/Drupal_Association_ind_member_217_0.png" alt="My individual membership of the Drupal Association" title="You can view my DA membership on drupal.org" width="168" height="168" /></a></div>
  </div>
</div>
<div id="block-block-10" class="block block-block">

    <h2>Drupal 8 API tutorials</h2>
  
  <div class="content">
    <p>Want to learn about the Drupal 8 APIs, with worked examples? <a href="/d8api.html">Follow my series of tutorials</a>, covering routing, caching, entities, config and much more!</p>
  </div>
</div>
<div id="block-stateblock-stateblock" class="block block-stateblock">

    <h2>Want to hire me?</h2>
  
  <div class="content">
    <a href="../contact.html"><section class="state-no">
  <header>I'm currently</header>
  <section class="state-description">fully booked</section>
  <footer>for freelance work. But you can click here to contact me!</footer>
</section></a>  </div>
</div>
<div id="block-ds-extras-blogpost-secondary-nav" class="block block-ds-extras">

    
  <div class="content">
    <div class="field field-name-taxonomy-vocabulary-6 field-type-taxonomy-term-reference field-label-above clearfix"><h3 class="field-label">Blog category: </h3><ul class="links"><li class="taxonomy-term-reference-0"><a href="../category/wordpress-category/discussion.html">discussion</a>, <a href="../category/wordpress-category/framework.html">framework</a></li></ul></div><div class="field field-name-taxonomy-vocabulary-7 field-type-taxonomy-term-reference field-label-above clearfix"><h3 class="field-label">Tags: </h3><ul class="links"><li class="taxonomy-term-reference-0"><a href="../category/tags/drush.html">drush</a>, <a href="../category/tags/drush-make.html">drush-make</a>, <a href="../category/tags/drush-instance.html">drush-instance</a></li></ul></div>  </div>
</div>
<div id="block-views-recent-blog-block-1" class="block block-views">

    <h2>Recent blogposts</h2>
  
  <div class="content">
    <div class="view view-recent-blog view-id-recent_blog view-display-id-block_1 view-dom-id-0f58d2490860a1909c990885593cb34c">
        
  
  
      <div class="view-content">
        <ul>
    <li class="first odd">
      
      <h3>
  
    
      <a href="../blog/2017-07-21/altering-length-drupal-8-text-field-contains-data.html">Altering the length of a Drupal 8 text field that contains data</a>
      </h3>
  

      <div>
  
    
      Friday, July 21, 2017 - 11:31
      </div>
  
    </li>
      <li class="even">
      
      <h3>
  
    
      <a href="../blog/2017-06-02/menagerie-testing-behavioural-unit-system-smoke-regression-oh-my.html">A menagerie of testing: behavioural, unit, system, smoke, regression, oh my!</a>
      </h3>
  

      <div>
  
    
      Friday, June 2, 2017 - 10:11
      </div>
  
    </li>
      <li class="last odd">
      
      <h3>
  
    
      <a href="../blog/2017-05-30/including-javascript-behat-tests-all-inside-headless-virtual-machine.html">Including Javascript in Behat tests, all inside a headless, virtual machine</a>
      </h3>
  

      <div>
  
    
      Tuesday, May 30, 2017 - 16:51
      </div>
  
    </li>
    </ul>
    </div>
  
  
  
      
<div class="more-link">
  <a href="../blog_view.html">
    All blogposts  </a>
</div>
  
  
  
</div>  </div>
</div>
<div id="block-block-5" class="block block-block">

    <h2>About me</h2>
  
  <div class="content">
    <p>I'm J-P Stacey, and I'm a freelance technical developer and software architect, working with <a href="http://drupal.org/">Drupal</a>, Javascript, Symfony, PHP and devops, with experience in project and process management and an emphasis on usability.</p>
<p>I live in the <a href="http://gov.uk">UK</a>; my website is self-hosted on <a href="http://bigv.io">bigv.io</a>; my email is hosted by <a href="http://mail.google.com">Google</a>, and that's also what I use to share files. <small>(<a href="https://data-jurisdiction.org/country/GB">More info</a>|<a href="/blog/2013-08-20/what-jurisdiction-am-i-in.html">What is this?</a>)</small></p>
  </div>
</div>
<div id="block-menu-secondary-menu" class="block block-menu">

    <h2>Find me elsewhere</h2>
  
  <div class="content">
    <ul class="menu clearfix"><li class="first leaf"><a href="http://twitter.com/mphield" title="My commercial account on Twitter">Company @ Twitter</a></li>
<li class="leaf"><a href="http://drupal.org/user/130486" title="Drupal user #130486: woohoo!">Drupal @ d.o</a></li>
<li class="leaf"><a href="http://github.com/jpstacey" title="My code repositories on Github">Code @ Github</a></li>
<li class="leaf"><a href="http://flickr.com/photos/eustatius" title="My photos on Flickr">Photos @ Flickr</a></li>
<li class="last leaf"><a href="http://pinboard.in/u:jpstacey" title="My links on the Pinboard bookmarking site">Links @ Pinboard</a></li>
</ul>  </div>
</div>
  </div>
      </div></div> <!-- /.section, /#sidebar-second -->
    
  </div></div> <!-- /#main, /#main-wrapper -->

  
  <div id="footer-wrapper"><div class="section">

    
    
  </div></div> <!-- /.section, /#footer-wrapper -->

</div></div> <!-- /#page, /#page-wrapper -->
  </body>
</html>
