<!DOCTYPE html>
<html lang="en" version="XHTML+RDFa 1.0" dir="ltr">
<head profile="http://www.w3.org/1999/xhtml/vocab">
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="../../sites/files/jps/starberry_favicon.png" type="image/png" />
<meta name="generator" content="Drupal 7 (https://www.drupal.org)" />
<link rel="canonical" href="building-drupal-site-behaviour-driven-development.html" />
<link rel="shortlink" href="../../node/626.html" />
  <title>Building a Drupal site with Behaviour-Driven Development | J-P Stacey</title>
  <link type="text/css" rel="stylesheet" href="../../sites/files/jps/css/css_xE-rWrJf-fncB6ztZfd2huxqgxu4WO-qwma6Xer30m4.css" media="all" />
<link type="text/css" rel="stylesheet" href="../../sites/files/jps/css/css_jdej_Zz2sjg--A2C2aVJ-Qt5W-fI_fkFnsddutilsws.css" media="all" />
<link type="text/css" rel="stylesheet" href="../../sites/files/jps/css/css_A3Qn9PgslsjDpW1HfgFuI26cQlhJ23E7y9wyYqpiJIA.css" media="all" />
<link type="text/css" rel="stylesheet" href="../../sites/files/jps/css/css_0Heb-O6YY5Tn5xG4WrHtAAXZCtYk-eKiVo7PlP1bsg4.css" media="all" />
<link type="text/css" rel="stylesheet" href="../../sites/files/jps/css/css_2THG1eGiBIizsWFeexsNe1iDifJ00QRS9uSd03rY9co.css" media="print" />

<!--[if lte IE 7]>
<link type="text/css" rel="stylesheet" href="/sites/default/themes/custom/barthes/css/ie.css?qfgo2z" media="all" />
<![endif]-->

<!--[if IE 6]>
<link type="text/css" rel="stylesheet" href="/sites/default/themes/custom/barthes/css/ie6.css?qfgo2z" media="all" />
<![endif]-->
  <script type="text/javascript" src="../../sites/files/jps/js/js_vDrW3Ry_4gtSYaLsh77lWhWjIC6ml2QNkcfvfP5CVFs.js"></script>
<script type="text/javascript" src="../../sites/files/jps/js/js_gPqjYq7fqdMzw8-29XWQIVoDSWTmZCGy9OqaHppNxuQ.js"></script>
<script type="text/javascript">
<!--//--><![CDATA[//><!--
(function(i,s,o,g,r,a,m){i["GoogleAnalyticsObject"]=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,"script","https://www.google-analytics.com/analytics.js","ga");ga("create", "UA-4775024-1", {"cookieDomain":"auto"});ga("set", "anonymizeIp", true);ga("send", "pageview");
//--><!]]>
</script>
<script type="text/javascript">
<!--//--><![CDATA[//><!--
jQuery.extend(Drupal.settings, {"basePath":"\/","pathPrefix":"","ajaxPageState":{"theme":"barthes","theme_token":"XfGyfn3ZXm6zPaq6Ep2dVQTbw-LhMltHDVfRiLAH6qQ","js":{"misc\/jquery.js":1,"misc\/jquery.once.js":1,"misc\/drupal.js":1,"sites\/all\/modules\/google_analytics\/googleanalytics.js":1,"0":1},"css":{"modules\/system\/system.base.css":1,"modules\/system\/system.menus.css":1,"modules\/system\/system.messages.css":1,"modules\/system\/system.theme.css":1,"modules\/comment\/comment.css":1,"sites\/all\/modules\/date\/date_api\/date.css":1,"sites\/all\/modules\/date\/date_popup\/themes\/datepicker.1.7.css":1,"modules\/field\/theme\/field.css":1,"sites\/all\/modules\/mollom\/mollom.css":1,"modules\/node\/node.css":1,"modules\/search\/search.css":1,"modules\/user\/user.css":1,"sites\/all\/modules\/views\/css\/views.css":1,"sites\/all\/modules\/media\/modules\/media_wysiwyg\/css\/media_wysiwyg.base.css":1,"sites\/all\/modules\/ctools\/css\/ctools.css":1,"public:\/\/geshi\/geshifilter-languages.css":1,"sites\/all\/modules\/geshifilter\/geshifilter.css":1,"themes\/bartik\/css\/layout.css":1,"themes\/bartik\/css\/style.css":1,"sites\/default\/themes\/custom\/barthes\/css\/colors.css":1,"sites\/default\/themes\/custom\/barthes\/css\/custom.css":1,"themes\/bartik\/css\/print.css":1,"sites\/default\/themes\/custom\/barthes\/css\/ie.css":1,"sites\/default\/themes\/custom\/barthes\/css\/ie6.css":1}},"googleanalytics":{"trackOutbound":1,"trackMailto":1,"trackDownload":1,"trackDownloadExtensions":"7z|aac|arc|arj|asf|asx|avi|bin|csv|doc(x|m)?|dot(x|m)?|exe|flv|gif|gz|gzip|hqx|jar|jpe?g|js|mp(2|3|4|e?g)|mov(ie)?|msi|msp|pdf|phps|png|ppt(x|m)?|pot(x|m)?|pps(x|m)?|ppam|sld(x|m)?|thmx|qtm?|ra(m|r)?|sea|sit|tar|tgz|torrent|txt|wav|wma|wmv|wpd|xls(x|m|b)?|xlt(x|m)|xlam|xml|z|zip"}});
//--><!]]>
</script>
</head>
<body class="html not-front not-logged-in one-sidebar sidebar-second page-node page-node- page-node-626 node-type-blog" >
  <div id="skip-link">
    <a href="building-drupal-site-behaviour-driven-development.html#main-content" class="element-invisible element-focusable">Skip to main content</a>
  </div>
    <div id="page-wrapper"><div id="page">

  <div id="header" class="with-secondary-menu"><div class="section clearfix">

    
          <div id="name-and-slogan">

                              <div id="site-name">
              <strong>
                <a href="../../index.html" title="Home" rel="home"><span>J-P Stacey</span></a>
              </strong>
            </div>
                  
                  <div id="site-slogan">
            Drupal, programming culture, gardening, cycling and the environment          </div>
        
      </div> <!-- /#name-and-slogan -->
    
    
    
          <div id="secondary-menu" class="navigation">
        <h2 class="element-invisible">Secondary menu</h2><ul id="secondary-menu-links" class="links inline clearfix"><li class="menu-7322 first"><a href="../../cv.html" title="My curriculum vitae">CV</a></li>
<li class="menu-7320 last"><a href="../../contact.html" title="">Contact me</a></li>
</ul>      </div> <!-- /#secondary-menu -->
    
  </div></div> <!-- /.section, /#header -->

  
  
  <div id="main-wrapper" class="clearfix"><div id="main" class="clearfix">

    
    
    <div id="content" class="column"><div class="section">
            <a id="main-content"></a>
                    <h1 class="title" id="page-title">
          Building a Drupal site with Behaviour-Driven Development        </h1>
                          <div class="tabs">
                  </div>
                          <div class="region region-content">
    <div id="block-system-main" class="block block-system">

    
  <div class="content">
    <div  class="ds-1col node node-blog node-promoted node-full view-mode-full clearfix">

  
  <div class="field field-name-post-date field-type-ds field-label-hidden"><div class="field-items"><div class="field-item even">Wednesday, February 10, 2016 - 20:03</div></div></div><div class="field field-name-field-body field-type-text-long field-label-hidden"><div class="field-items"><div class="field-item even"><p><em>(This article <a href="http://agile.coop/blog/case-study-behaviour-driven-development-bbd-using-behat-and-drupal-forest-desk">first appeared on the Agile Collective blog</a>.)</em></p>
<p>The <a href="http://agile.coop/client/global-canopy-programme-gcp">Global Canopy Programme (GCP)</a> needed to retrieve news syndicated from many public sources, manage it via an internal application, then re-syndicate it reliably to several public-facing websites. This application—called Forest Desk—needed to be described and built “just in time”, both to fit the clear initial requirements but also to adapt to any discoveries made along the way.</p>
<h3>Background</h3>
<p>I was asked to work with <a href="http://agile.coop/">Agile Collective</a>, as a technical partner, to help GCP to build Forest Desk using everyone's current preferred framework of Drupal 7. It promised to be a neat, compact site, with the potential for good in-house user experience and great performance. However, while the fundamental goals of the project were clear, all parties all agreed that the project had to:</p>
<ul><li>support rapid iteration of features and just-in-time specification of the details,</li>
<li>while also being reassured that ongoing development was stable and correct.</li>
</ul><p>With those two demands in mind, the paradigm of <a href="https://www.wikiwand.com/en/Behavior-driven_development">behaviour-driven development or BDD</a> was decided on very early in the project. Like test-driven development more generally, BDD improves understanding of, and adherence to, requirements. This is done via a 3-step process for each requirement:</p>
<ol><li>Formalize the requirement: in this case, write it down as a semi-human-readable set of “scenarios” using a limited subset of English, called <a href="http://docs.behat.org/en/v2.5/guides/1.gherkin.html">Gherkin</a>.</li>
<li>Use software to turn these scenarios into automated tests, and run them even before the required functionality is in place, to show they “fail as expected” in its absence.</li>
<li>Build the required functionality (tweaking the scenarios where they were initially unclear) until the test passes.</li>
</ol><p>This simple BDD process could be followed for each piece of functionality in turn, and embedded in a wider project-management framework like <a href="https://en.wikipedia.org/wiki/Scrum_%28development%29">Scrum</a>. Such an environment can lead to not just a usable end product, but also tried and tested functionality underpinning it, both now and the future.</p>
<h3>Getting agreement</h3>
<p>Everyone brings their own assumptions to a project, and often two people can be using the same words and phrases to describe quite different ideas that each has in mind. The traditional approach for sounding out such potentially dangerous scope misalignment has been to do a lot of up-front discovery, but this doesn’t just delay a project, but can even provide a false sense of security: becoming out of date; or being so large that it hides inconsistencies which only become apparent as the deadline approaches.</p>
<p>Instead of a discovery-phase approach, each requirement is sounded out in the "just in time" fashion alluded to earlier: only when required, and even then only in terms of the behaviours of the website as the user tries to attain certain goals. Gherkin allows expression of this behaviour from the site user’s perspective in a series of scenarios like:</p>
<ul><li>Given
<ul><li>I am logged in</li>
<li>And I am on the homepage</li>
</ul></li>
<li>When
<ul><li>I click on “My account”</li>
<li>And I click on “Edit profile”</li>
</ul></li>
<li>Then
<ul><li>I should see a “Your username” element</li>
<li>And I should see a “Your password” element</li>
</ul></li>
</ul><p>Although bits of the above can be omitted, there’s not much deviation permitted from the format. And because it’s so restrictive, it requires people to spell out their thoughts more clearly, eliminating misunderstandings.</p>
<p>Still following the principle of just-in-time specification, all stakeholders allowed the project to proceed even if the functionality isn't completely fleshed out. This allowed subtle, hard-to-translate bits of functionality to remain un(der)described at the specification stage; for example:</p>
<ul><li>Given
<ul><li>I am logged in</li>
<li>And <em>I press a button and some custom functionality happens</em></li>
</ul></li>
<li>Then
<ul><li><em>I should see new content retrieved from some remote syndication</em></li>
</ul></li>
</ul><p>The italicized bits of the specification are not commonly understood by programs which can read Gherkin. But the point is that such a test will fail, and draw attention to itself rather than permit them to be forgotten. In the meantime, doing this allows the project to keep moving, accepting that either everyone gets involved to flesh out such scenarios out further, or leave such sections to the developer’s judgment as an implementation detail.</p>
<h3>Letting computers understand requirements</h3>
<p>Once requirements were spelled out in the limited syntax above, in text files on disk, a separate application called <a href="http://docs.behat.org/en/v2.5/quick_intro.html">Behat</a> could read the text files, visit the website in development, and see if the functionality was built yet.</p>
<p>Behat can act just like a human being sat in front of a web-browser (with some limitations), but can also utilise the rest of a developer’s computer to set the website up (ditto). What this means in practice is that, for example, one need never specify particular user accounts in tests, or have particular content already set up on a development copy of the website. Behat can prepare content and accounts for tests, ready for the tests to then make use of them.</p>
<p>A successful run by Behat would result in a computer screen full of literally green lights: each line of the scenario goes green if Behat both understands it and also can actually fulfil it: click on this link; or put this text into this input box.</p>
<p style="text-align: center;"><a class="media-element file-inline-image" href="/sites/files/jps/behat-test-running-gherkin.png"><img alt="" src="http://www.jpstacey.info/sites/files/jps/styles/large/public/behat-test-running-gherkin.png?itok=sTkGmQwK.html" /></a><br /><em>A running BDD test, using Behat. Green lights mean go!</em></p>
<p>However, if anything was either broken or not yet written, the developer would receive clear red alerts that action was required.</p>
<p>I was also able to extend Behat’s knowledge of what constitutes a comprehensible action on a website. It already knew about clicking links, or hitting submit buttons, but a key requirement was to get it to understand RSS, the format for syndicating content on the web. I was able to do this very quickly with custom PHP code.</p>
<p>In no time at all, I would have a new Gherkin requirement, being interpreted by Behat, and showing lots of red warning lights: because by that point, it was only specified, not built! But at the same time, older functionality would still show green lights, indicating that more recent work was not conflicting with the requirements of somewhat older work.</p>
<h3>Building the functionality</h3>
<p>Lots of the technologies built upon already existed, and were tried and tested. The RSS standard was chosen for syndicating data, and Drupal has very good support for both consuming this standard from remote websites (using the <a href="https://www.drupal.org/project/feeds">Feeds module</a>) and also repackaging it for consumption by other websites (using Views and <a href="https://www.drupal.org/project/views_rss">Views RSS</a>). Because this was intended as an internal project, I also implemented a clear, plain, crisp administrative design throughout, provided by the <a href="https://www.drupal.org/project/adminimal_theme">Adminimal theme</a>.</p>
<p>When it came to building each feature, once its scenario was specified in Gherkin syntax, most of the work was possible using Drupal content types, views and other configuration, which could be stored alongside the codebase using the <a href="https://www.drupal.org/project/features">Features module</a>. This allowed changes of configuration, which could then be saved, and then always if necessary return to the previous state of configuration should any BDD tests no longer pass.</p>
<p>A few small customizations were necessary, but I could isolate these:</p>
<ol><li>When a website user was making the decision to re-syndicate content, on the same page as the content a link was required to the exact remote RSS feed that was the source for the content.</li>
<li>When the content was being re-syndicated from Forest Desk to another GCP website, not only did its content tagging need to be preserved (e.g. this content pertains to “Palm oil”) but the tagging needed to end up in the right vocabulary on the remote site (e.g. “Palm oil” is a commodity, not a country or piece of legislation). This required a custom extension to RSS.</li>
<li>Similarly, when content tagged with geographical locations (e.g. longitude and latitude points) needed to be re-syndicated, the GeoRSS standard needed to be implemented to re-display the locations in the right format.</li>
</ol><p>However, each customization, in effect, supported a very specific piece of functionality; removing it only affected that piece, leaving the rest of the website functioning correctly.</p>
<h3>Summary</h3>
<p>Behaviour-driven development permitted a website to be specified and built quickly and within agile principles. It also meant that at the end of the project a successfully running test suite was delivered along with the website, a suite could be automated for peace of mind both during the acceptance phase but also for any future ongoing development. This means that changes of all sizes can be made with much greater confidence.</p>
<p>Moreover, the resulting suite of BDD tests is a living, breathing part of the website project in its own right, indirectly serving the site’s users by guaranteeing a minimum quality of experience and functionality. As the website itself grows, the suite will not just support the growth, but will be able to grow with it and become richer at the same time.</p>
</div></div></div><div id="comments" class="comment-wrapper">
  
  
  </div>
</div>

  </div>
</div>
  </div>
      
    </div></div> <!-- /.section, /#content -->

          <div id="sidebar-second" class="column sidebar"><div class="section">
          <div class="region region-sidebar-second">
    <div id="block-block-7" class="block block-block">

    <h2>I&#039;m a Drupal Association member!</h2>
  
  <div class="content">
    <div style="margin: -15px 0"><a href="https://drupal.org/user/130486"><img src="https://association.drupal.org/files/Drupal_Association_ind_member_217_0.png" alt="My individual membership of the Drupal Association" title="You can view my DA membership on drupal.org" width="168" height="168" /></a></div>
  </div>
</div>
<div id="block-block-10" class="block block-block">

    <h2>Drupal 8 API tutorials</h2>
  
  <div class="content">
    <p>Want to learn about the Drupal 8 APIs, with worked examples? <a href="/d8api.html">Follow my series of tutorials</a>, covering routing, caching, entities, config and much more!</p>
  </div>
</div>
<div id="block-stateblock-stateblock" class="block block-stateblock">

    <h2>Want to hire me?</h2>
  
  <div class="content">
    <a href="../../contact.html"><section class="state-no">
  <header>I'm currently</header>
  <section class="state-description">fully booked</section>
  <footer>for freelance work. But you can click here to contact me!</footer>
</section></a>  </div>
</div>
<div id="block-ds-extras-blogpost-secondary-nav" class="block block-ds-extras">

    
  <div class="content">
    <div class="field field-name-taxonomy-vocabulary-6 field-type-taxonomy-term-reference field-label-above clearfix"><h3 class="field-label">Blog category: </h3><ul class="links"><li class="taxonomy-term-reference-0"><a href="../../category/wordpress-category/paradigms.html">paradigms</a>, <a href="../../category/wordpress-category/projects.html">projects</a></li></ul></div><div class="field field-name-taxonomy-vocabulary-7 field-type-taxonomy-term-reference field-label-above clearfix"><h3 class="field-label">Tags: </h3><ul class="links"><li class="taxonomy-term-reference-0"><a href="../../category/tags/myportfolio.html">myportfolio</a>, <a href="../../category/wordpress-tag/drupal.html">drupal</a>, <a href="../../category/tags/bdd.html">bdd</a>, <a href="../../category/tags/behat.html">behat</a>, <a href="../../category/wordpress-tag/testing.html">testing</a>, <a href="../../category/tags/planetdrupal.html">planetdrupal</a></li></ul></div>  </div>
</div>
<div id="block-views-recent-blog-block-1" class="block block-views">

    <h2>Recent blogposts</h2>
  
  <div class="content">
    <div class="view view-recent-blog view-id-recent_blog view-display-id-block_1 view-dom-id-888da4ab87aac8fec6eca120cd4ffbe0">
        
  
  
      <div class="view-content">
        <ul>
    <li class="first odd">
      
      <h3>
  
    
      <a href="../2017-07-21/altering-length-drupal-8-text-field-contains-data.html">Altering the length of a Drupal 8 text field that contains data</a>
      </h3>
  

      <div>
  
    
      Friday, July 21, 2017 - 11:31
      </div>
  
    </li>
      <li class="even">
      
      <h3>
  
    
      <a href="../2017-06-02/menagerie-testing-behavioural-unit-system-smoke-regression-oh-my.html">A menagerie of testing: behavioural, unit, system, smoke, regression, oh my!</a>
      </h3>
  

      <div>
  
    
      Friday, June 2, 2017 - 10:11
      </div>
  
    </li>
      <li class="last odd">
      
      <h3>
  
    
      <a href="../2017-05-30/including-javascript-behat-tests-all-inside-headless-virtual-machine.html">Including Javascript in Behat tests, all inside a headless, virtual machine</a>
      </h3>
  

      <div>
  
    
      Tuesday, May 30, 2017 - 16:51
      </div>
  
    </li>
    </ul>
    </div>
  
  
  
      
<div class="more-link">
  <a href="../../blog_view.html">
    All blogposts  </a>
</div>
  
  
  
</div>  </div>
</div>
<div id="block-block-5" class="block block-block">

    <h2>About me</h2>
  
  <div class="content">
    <p>I'm J-P Stacey, and I'm a freelance technical developer and software architect, working with <a href="http://drupal.org/">Drupal</a>, Javascript, Symfony, PHP and devops, with experience in project and process management and an emphasis on usability.</p>
<p>I live in the <a href="http://gov.uk">UK</a>; my website is self-hosted on <a href="http://bigv.io">bigv.io</a>; my email is hosted by <a href="http://mail.google.com">Google</a>, and that's also what I use to share files. <small>(<a href="https://data-jurisdiction.org/country/GB">More info</a>|<a href="/blog/2013-08-20/what-jurisdiction-am-i-in.html">What is this?</a>)</small></p>
  </div>
</div>
<div id="block-menu-secondary-menu" class="block block-menu">

    <h2>Find me elsewhere</h2>
  
  <div class="content">
    <ul class="menu clearfix"><li class="first leaf"><a href="http://twitter.com/mphield" title="My commercial account on Twitter">Company @ Twitter</a></li>
<li class="leaf"><a href="http://drupal.org/user/130486" title="Drupal user #130486: woohoo!">Drupal @ d.o</a></li>
<li class="leaf"><a href="http://github.com/jpstacey" title="My code repositories on Github">Code @ Github</a></li>
<li class="leaf"><a href="http://flickr.com/photos/eustatius" title="My photos on Flickr">Photos @ Flickr</a></li>
<li class="last leaf"><a href="http://pinboard.in/u:jpstacey" title="My links on the Pinboard bookmarking site">Links @ Pinboard</a></li>
</ul>  </div>
</div>
  </div>
      </div></div> <!-- /.section, /#sidebar-second -->
    
  </div></div> <!-- /#main, /#main-wrapper -->

  
  <div id="footer-wrapper"><div class="section">

    
    
  </div></div> <!-- /.section, /#footer-wrapper -->

</div></div> <!-- /#page, /#page-wrapper -->
  </body>
</html>
