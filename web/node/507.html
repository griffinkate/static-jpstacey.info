<!DOCTYPE html>
<html lang="en" version="XHTML+RDFa 1.0" dir="ltr">
<head profile="http://www.w3.org/1999/xhtml/vocab">
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="../sites/files/jps/starberry_favicon.png" type="image/png" />
<meta name="generator" content="Drupal 7 (https://www.drupal.org)" />
<link rel="canonical" href="../blog/2014-03-18/gradually-encrypting-my-work-environment.html" />
<link rel="shortlink" href="507.html" />
  <title>Gradually encrypting my work environment | J-P Stacey</title>
  <link type="text/css" rel="stylesheet" href="../sites/files/jps/css/css_xE-rWrJf-fncB6ztZfd2huxqgxu4WO-qwma6Xer30m4.css" media="all" />
<link type="text/css" rel="stylesheet" href="../sites/files/jps/css/css_jdej_Zz2sjg--A2C2aVJ-Qt5W-fI_fkFnsddutilsws.css" media="all" />
<link type="text/css" rel="stylesheet" href="../sites/files/jps/css/css_A3Qn9PgslsjDpW1HfgFuI26cQlhJ23E7y9wyYqpiJIA.css" media="all" />
<link type="text/css" rel="stylesheet" href="../sites/files/jps/css/css_0Heb-O6YY5Tn5xG4WrHtAAXZCtYk-eKiVo7PlP1bsg4.css" media="all" />
<link type="text/css" rel="stylesheet" href="../sites/files/jps/css/css_2THG1eGiBIizsWFeexsNe1iDifJ00QRS9uSd03rY9co.css" media="print" />

<!--[if lte IE 7]>
<link type="text/css" rel="stylesheet" href="http://jpstacey.lndo.site/sites/default/themes/custom/barthes/css/ie.css?qfgo2z" media="all" />
<![endif]-->

<!--[if IE 6]>
<link type="text/css" rel="stylesheet" href="http://jpstacey.lndo.site/sites/default/themes/custom/barthes/css/ie6.css?qfgo2z" media="all" />
<![endif]-->
  <script type="text/javascript" src="../sites/files/jps/js/js_vDrW3Ry_4gtSYaLsh77lWhWjIC6ml2QNkcfvfP5CVFs.js"></script>
<script type="text/javascript" src="../sites/files/jps/js/js_gPqjYq7fqdMzw8-29XWQIVoDSWTmZCGy9OqaHppNxuQ.js"></script>
<script type="text/javascript">
<!--//--><![CDATA[//><!--
(function(i,s,o,g,r,a,m){i["GoogleAnalyticsObject"]=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,"script","https://www.google-analytics.com/analytics.js","ga");ga("create", "UA-4775024-1", {"cookieDomain":"auto"});ga("set", "anonymizeIp", true);ga("send", "pageview");
//--><!]]>
</script>
<script type="text/javascript">
<!--//--><![CDATA[//><!--
jQuery.extend(Drupal.settings, {"basePath":"\/","pathPrefix":"","ajaxPageState":{"theme":"barthes","theme_token":"PQT-kKenrFEDVwQAppk5-zFW1OLDUpxNoxj2CfSqEkY","js":{"misc\/jquery.js":1,"misc\/jquery.once.js":1,"misc\/drupal.js":1,"sites\/all\/modules\/google_analytics\/googleanalytics.js":1,"0":1},"css":{"modules\/system\/system.base.css":1,"modules\/system\/system.menus.css":1,"modules\/system\/system.messages.css":1,"modules\/system\/system.theme.css":1,"modules\/comment\/comment.css":1,"sites\/all\/modules\/date\/date_api\/date.css":1,"sites\/all\/modules\/date\/date_popup\/themes\/datepicker.1.7.css":1,"modules\/field\/theme\/field.css":1,"sites\/all\/modules\/mollom\/mollom.css":1,"modules\/node\/node.css":1,"modules\/search\/search.css":1,"modules\/user\/user.css":1,"sites\/all\/modules\/views\/css\/views.css":1,"sites\/all\/modules\/media\/modules\/media_wysiwyg\/css\/media_wysiwyg.base.css":1,"sites\/all\/modules\/ctools\/css\/ctools.css":1,"public:\/\/geshi\/geshifilter-languages.css":1,"sites\/all\/modules\/geshifilter\/geshifilter.css":1,"themes\/bartik\/css\/layout.css":1,"themes\/bartik\/css\/style.css":1,"sites\/default\/themes\/custom\/barthes\/css\/colors.css":1,"sites\/default\/themes\/custom\/barthes\/css\/custom.css":1,"themes\/bartik\/css\/print.css":1,"sites\/default\/themes\/custom\/barthes\/css\/ie.css":1,"sites\/default\/themes\/custom\/barthes\/css\/ie6.css":1}},"googleanalytics":{"trackOutbound":1,"trackMailto":1,"trackDownload":1,"trackDownloadExtensions":"7z|aac|arc|arj|asf|asx|avi|bin|csv|doc(x|m)?|dot(x|m)?|exe|flv|gif|gz|gzip|hqx|jar|jpe?g|js|mp(2|3|4|e?g)|mov(ie)?|msi|msp|pdf|phps|png|ppt(x|m)?|pot(x|m)?|pps(x|m)?|ppam|sld(x|m)?|thmx|qtm?|ra(m|r)?|sea|sit|tar|tgz|torrent|txt|wav|wma|wmv|wpd|xls(x|m|b)?|xlt(x|m)|xlam|xml|z|zip"}});
//--><!]]>
</script>
</head>
<body class="html not-front not-logged-in one-sidebar sidebar-second page-node page-node- page-node-507 node-type-blog" >
  <div id="skip-link">
    <a href="507.html#main-content" class="element-invisible element-focusable">Skip to main content</a>
  </div>
    <div id="page-wrapper"><div id="page">

  <div id="header" class="with-secondary-menu"><div class="section clearfix">

    
          <div id="name-and-slogan">

                              <div id="site-name">
              <strong>
                <a href="../index.html" title="Home" rel="home"><span>J-P Stacey</span></a>
              </strong>
            </div>
                  
                  <div id="site-slogan">
            Drupal, programming culture, gardening, cycling and the environment          </div>
        
      </div> <!-- /#name-and-slogan -->
    
    
    
          <div id="secondary-menu" class="navigation">
        <h2 class="element-invisible">Secondary menu</h2><ul id="secondary-menu-links" class="links inline clearfix"><li class="menu-7322 first"><a href="../cv.html" title="My curriculum vitae">CV</a></li>
<li class="menu-7320 last"><a href="../contact.html" title="">Contact me</a></li>
</ul>      </div> <!-- /#secondary-menu -->
    
  </div></div> <!-- /.section, /#header -->

  
  
  <div id="main-wrapper" class="clearfix"><div id="main" class="clearfix">

    
    
    <div id="content" class="column"><div class="section">
            <a id="main-content"></a>
                    <h1 class="title" id="page-title">
          Gradually encrypting my work environment        </h1>
                          <div class="tabs">
                  </div>
                          <div class="region region-content">
    <div id="block-system-main" class="block block-system">

    
  <div class="content">
    <div  class="ds-1col node node-blog node-promoted node-full view-mode-full clearfix">

  
  <div class="field field-name-post-date field-type-ds field-label-hidden"><div class="field-items"><div class="field-item even">Tuesday, March 18, 2014 - 20:30</div></div></div><div class="field field-name-field-body field-type-text-long field-label-hidden"><div class="field-items"><div class="field-item even"><p>When work is outsourced to a freelancer or agency, the client needs to have reassurance that the external developer will respect any data or intellectual property that must needs escape their personal control, however briefly. While it's all very well to encapsulate this in contractual liabilities, it's also a great service to be able to offer your clients peace of mind.</p>
<p>Enter encryption. The ideal scenario - total encryption of one's entire work environment - is probably not achievable by most people overnight, certainly not without sacrificing a lot of their existing system's configuration (or at least running the risk.) And in this specific context of reasonable liability, it's almost not worth discussing things like NSA-instigated back doors.</p>
<p>All that aside, there's still a lot of simple quick wins you can achieve with incremental encryption, piece by piece, of the code and data you work with. Piecewise encryption won't guarantee your liability in super-confidential environments, but it will dramatically minimize your exposure to difficult situations, should you lose your laptop or become the victim of a theft.</p>
<p>Here's a few simple encryptions I've implemented on my work environment which might be of interest to other people working similarly with a third party's electronic property.</p>
<h2>Remote storage</h2>
<p>Encrypting a USB stick in Ubuntu is trivial: here's<a href="https://help.ubuntu.com/community/EncryptedFilesystemsOnRemovableStorage"> a wiki page about how to encrypt removable storage</a>. It's arguably the first and biggest thing you can do, because even if you keep your laptop in a vault at home, you might still be exposed to risk through losing tiny bits of electronics like USB sticks. With an encrypted stick you can visit a client's office environment, and if they want to give you some files to take home, you can do so while showing clear consideration for theirr data.</p>
<p>Note that if you initialize the encryption, but don't then create the filesystem at that point, you have to start again: it won't mount properly if you bail half-way through. Also, the GUI is a bit fiddly: I found that it would neither let me start with the stick unmounted, nor actually encrypt when mounted. It's probably best to follow the above steps using the command line.</p>
<h2>Home folder including documents folders</h2>
<p>You should encrypt your home folder if your client sends you commercially sensitive documentation; and then actually store it there, obviously!</p>
<p>Ubuntu offers encryption of the home folder as an option when you're installing. Retrofitting such encryption at a later date is a little bit trickier, but possible. To do so, you <a href="http://www.howtogeek.com/116032/">need a temporary, separate admin user and and it's mostly straightforward</a>, but here's a few extra notes: </p>
<ul><li>Before encrypting, consider moving large files elsewhere, and maybe symlinking the directories in. "du --max-depth=1" can help you gradually drill down to large files, although simply moving any big VM boxes out would be a good first step!</li>
<li>Your own account should be both logged out and also have no more processes running: check "ps aux" for any processes owned by that user, and kill them with "kill -kill". These processes could be accessing files in your home directory, which blocks conversion to encrypted.</li>
<li>The temporary user shouldn't have their own home folder encrypted, as it seemed to confuse at least one of the sudo commands (I can't remember which.) But it's a temporary user anyway.</li>
<li>You might also encounter <a href="https://bugs.launchpad.net/ubuntu/+source/gvfs/+bug/225361">this gvfs bug</a> but I don't think that it actually blocks, as long as you've done the above.)</li>
</ul><h2>Codebases: web root</h2>
<p>Specific folders can be encrypted using <a href="https://help.ubuntu.com/community/FolderEncryption">encfs</a>. This encrypts any folder, which you'll typically hide, then use the Linux "mount" command to turn it into a separate decrypted folder while your owner-user account is logged in. <a href="https://code.google.com/p/pam-encfs/">libpam-encfs</a> extends encfs so that it will automatically mount and decrypt as you log in. Here's a few pointers:</p>
<ul><li>You need to specify the --public option to encfs whenever it runs, so that your webserver user (www-data if you're using Apache) can see in the folder(s).</li>
<li>Both encfs and libpam-encfs are available in Ubuntu's package repositories: sudo apt-get install encfs libpam-encfs</li>
<li>Add yourself to the fuse user group, by editing /etc/group if you need to</li>
<li>Ensure /etc/fuse.conf is group-owned by the same group: sudo chgrp /etc/fuse.conf &amp;&amp; sudo chmod g+r /etc/fuse.conf</li>
</ul><p>In /etc/security/pam_encfs.conf, you should make the following changes:</p>
<ul><li>remove "drop_permissions" so that --public is respected</li>
<li>remove --idle=1 from encfs_default unless you want detaching on idle - not sure what the criteria for "idle" are, so if you can't see a reason to detach, I'd keep it connected.</li>
<li>Give fuse allow_other privileges, not allow_root, as that conflicts with giving encfs the --public permissions</li>
<li>Add the mount point to the list at the end of the file.</li>
</ul><p>At this point you can probably reboot to test whether or not this works. Rather than logging into graphical Unity, GNOME or similar, you should press CTRL-ALT-F1 and log in at the terminal; that'll give you more feedback in case any of the configuration is wrong. Incidentally, the <a style="line-height: 1.538em;" href="http://jpstacey.lndo.site/node/The&#32;documentation&#32;for&#32;pam-encfs&#32;http://pam-encfs.googlecode.com/svn/trunk/README)">documentation for pam-encfs</a> is idiosyncratic to say the least, and I feel your pain, but: it's actually a lot more straightforward than it seems.</p>
<h2>Databases: don't encrypt; cleanse instead</h2>
<p>In theory you could also encrypt your database storage folders too: for example, MySQL stores all of its files in /var/lib/mysql. However, a much safer practice is to not rely on encryption at all, and instead cleanse the database as you import it; better, ask the client for cleansed copies, so you never have sensitive data on your machine. Obviously if you're doing e.g. a data migration then cleansing the database is often not feasible.</p>
<p>However, once the data is clean of anything sensitive or personal, the only remaining issue is if your client considers the database schema to be their intellectual property. This isn't likely to arise if the schema is created e.g. by third-party software like Drupal, but you should probably confirm it with the client if you're worried.</p>
<h2>Summary</h2>
<p>One of the down sides of freelancing, or becoming your own boss generally, is that the liabilities which used to fall on your employer's shoulders - leaving you with the maximum liability of losing your job - now fall squarely on yours and yours alone. While there's a feeling of pride in representing yourself or your own company, there's also considerable risk involved when iit's just you versus the world. Implementing small amounts of encryption here and there can quickly provide peace of mind for your clients, but also for yourself and your business.</p>
</div></div></div><div id="comments" class="comment-wrapper">
          <h2 class="title">Comments</h2>
      
  <a id="comment-173"></a>
<div class="comment comment-by-anonymous clearfix">

  <div class="attribution">

    
    <div class="submitted">
      <p class="commenter-name">
        <span class="username">Pete Smith (not verified)</span>      </p>
      <p class="comment-time">
        Wed, 26/03/2014 - 14:17      </p>
      <p class="comment-permalink">
        <a href="../comment/173.html#comment-173" class="permalink" rel="bookmark">Permalink</a>      </p>
    </div>
  </div>

  <div class="comment-text">
    <div class="comment-arrow"></div>

    
    <div style='display: none;'>    <h3><a href="../comment/173.html#comment-173" class="permalink" rel="bookmark">Nice review of what&#039;s</a></h3>
    </div>
    <div class="content">
      <div class="field field-name-comment-body field-type-text-long field-label-hidden"><div class="field-items"><div class="field-item even"><p>Nice review of what's available, J-P, thanks! The end of the penultimate sentence of final para is missing.</p>
</div></div></div>          </div> <!-- /.content -->

    <ul class="links inline"><li class="comment-reply first last"><a href="../comment/reply/507/173.html">reply</a></li>
</ul>  </div> <!-- /.comment-text -->
</div>

<div class="indented"><a id="comment-174"></a>
<div class="comment comment-by-node-author clearfix">

  <div class="attribution">

    
    <div class="submitted">
      <p class="commenter-name">
        <span class="username">jp.stacey</span>      </p>
      <p class="comment-time">
        Wed, 26/03/2014 - 14:58      </p>
      <p class="comment-permalink">
        <a href="../comment/174.html#comment-174" class="permalink" rel="bookmark">Permalink</a>      </p>
    </div>
  </div>

  <div class="comment-text">
    <div class="comment-arrow"></div>

    
    <div style='display: none;'>    <h3><a href="../comment/174.html#comment-174" class="permalink" rel="bookmark">Well done. It was a test, to</a></h3>
    </div>
    <div class="content">
      <div class="field field-name-comment-body field-type-text-long field-label-hidden"><div class="field-items"><div class="field-item even"><p>Well done. It was a test, to see who would read down to the bottom first, or at any rate read that far and still be paying attention.</p>
<p>You passed with flying colours. I mean, you don't actually get anything for doing so. Except that warm glow you're currently feeling.</p>
<p>(Edited now; ta!)</p>
</div></div></div>          </div> <!-- /.content -->

    <ul class="links inline"><li class="comment-reply first last"><a href="../comment/reply/507/174.html">reply</a></li>
</ul>  </div> <!-- /.comment-text -->
</div>
</div>
  </div>
</div>

  </div>
</div>
  </div>
      
    </div></div> <!-- /.section, /#content -->

          <div id="sidebar-second" class="column sidebar"><div class="section">
          <div class="region region-sidebar-second">
    <div id="block-block-7" class="block block-block">

    <h2>I&#039;m a Drupal Association member!</h2>
  
  <div class="content">
    <div style="margin: -15px 0"><a href="https://drupal.org/user/130486"><img src="https://association.drupal.org/files/Drupal_Association_ind_member_217_0.png" alt="My individual membership of the Drupal Association" title="You can view my DA membership on drupal.org" width="168" height="168" /></a></div>
  </div>
</div>
<div id="block-block-10" class="block block-block">

    <h2>Drupal 8 API tutorials</h2>
  
  <div class="content">
    <p>Want to learn about the Drupal 8 APIs, with worked examples? <a href="/d8api.html">Follow my series of tutorials</a>, covering routing, caching, entities, config and much more!</p>
  </div>
</div>
<div id="block-stateblock-stateblock" class="block block-stateblock">

    <h2>Want to hire me?</h2>
  
  <div class="content">
    <a href="../contact.html"><section class="state-no">
  <header>I'm currently</header>
  <section class="state-description">fully booked</section>
  <footer>for freelance work. But you can click here to contact me!</footer>
</section></a>  </div>
</div>
<div id="block-ds-extras-blogpost-secondary-nav" class="block block-ds-extras">

    
  <div class="content">
    <div class="field field-name-taxonomy-vocabulary-6 field-type-taxonomy-term-reference field-label-above clearfix"><h3 class="field-label">Blog category: </h3><ul class="links"><li class="taxonomy-term-reference-0"><a href="../category/wordpress-category/configuration.html">configuration</a>, <a href="../category/wordpress-category/hacking.html">hacking</a>, <a href="../category/wordpress-category/information.html">information</a>, <a href="../category/wordpress-category/security.html">security</a></li></ul></div><div class="field field-name-taxonomy-vocabulary-7 field-type-taxonomy-term-reference field-label-above clearfix"><h3 class="field-label">Tags: </h3><ul class="links"><li class="taxonomy-term-reference-0"><a href="../category/tags/encryption.html">encryption</a>, <a href="../category/wordpress-tag/freelance.html">freelance</a>, <a href="../category/tags/dpa.html">dpa</a>, <a href="../category/tags/thirdparty.html">thirdparty</a></li></ul></div>  </div>
</div>
<div id="block-views-recent-blog-block-1" class="block block-views">

    <h2>Recent blogposts</h2>
  
  <div class="content">
    <div class="view view-recent-blog view-id-recent_blog view-display-id-block_1 view-dom-id-a6215d5d0357cd3208c57d65d229ef70">
        
  
  
      <div class="view-content">
        <ul>
    <li class="first odd">
      
      <h3>
  
    
      <a href="../blog/2017-07-21/altering-length-drupal-8-text-field-contains-data.html">Altering the length of a Drupal 8 text field that contains data</a>
      </h3>
  

      <div>
  
    
      Friday, July 21, 2017 - 11:31
      </div>
  
    </li>
      <li class="even">
      
      <h3>
  
    
      <a href="../blog/2017-06-02/menagerie-testing-behavioural-unit-system-smoke-regression-oh-my.html">A menagerie of testing: behavioural, unit, system, smoke, regression, oh my!</a>
      </h3>
  

      <div>
  
    
      Friday, June 2, 2017 - 10:11
      </div>
  
    </li>
      <li class="last odd">
      
      <h3>
  
    
      <a href="../blog/2017-05-30/including-javascript-behat-tests-all-inside-headless-virtual-machine.html">Including Javascript in Behat tests, all inside a headless, virtual machine</a>
      </h3>
  

      <div>
  
    
      Tuesday, May 30, 2017 - 16:51
      </div>
  
    </li>
    </ul>
    </div>
  
  
  
      
<div class="more-link">
  <a href="../blog_view.html">
    All blogposts  </a>
</div>
  
  
  
</div>  </div>
</div>
<div id="block-block-5" class="block block-block">

    <h2>About me</h2>
  
  <div class="content">
    <p>I'm J-P Stacey, and I'm a freelance technical developer and software architect, working with <a href="http://drupal.org/">Drupal</a>, Javascript, Symfony, PHP and devops, with experience in project and process management and an emphasis on usability.</p>
<p>I live in the <a href="http://gov.uk">UK</a>; my website is self-hosted on <a href="http://bigv.io">bigv.io</a>; my email is hosted by <a href="http://mail.google.com">Google</a>, and that's also what I use to share files. <small>(<a href="https://data-jurisdiction.org/country/GB">More info</a>|<a href="/blog/2013-08-20/what-jurisdiction-am-i-in.html">What is this?</a>)</small></p>
  </div>
</div>
<div id="block-menu-secondary-menu" class="block block-menu">

    <h2>Find me elsewhere</h2>
  
  <div class="content">
    <ul class="menu clearfix"><li class="first leaf"><a href="http://twitter.com/mphield" title="My commercial account on Twitter">Company @ Twitter</a></li>
<li class="leaf"><a href="http://drupal.org/user/130486" title="Drupal user #130486: woohoo!">Drupal @ d.o</a></li>
<li class="leaf"><a href="http://github.com/jpstacey" title="My code repositories on Github">Code @ Github</a></li>
<li class="leaf"><a href="http://flickr.com/photos/eustatius" title="My photos on Flickr">Photos @ Flickr</a></li>
<li class="last leaf"><a href="http://pinboard.in/u:jpstacey" title="My links on the Pinboard bookmarking site">Links @ Pinboard</a></li>
</ul>  </div>
</div>
  </div>
      </div></div> <!-- /.section, /#sidebar-second -->
    
  </div></div> <!-- /#main, /#main-wrapper -->

  
  <div id="footer-wrapper"><div class="section">

    
    
  </div></div> <!-- /.section, /#footer-wrapper -->

</div></div> <!-- /#page, /#page-wrapper -->
  </body>
</html>
