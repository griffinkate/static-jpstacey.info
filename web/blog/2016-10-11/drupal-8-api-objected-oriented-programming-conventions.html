<!DOCTYPE html>
<html lang="en" version="XHTML+RDFa 1.0" dir="ltr">
<head profile="http://www.w3.org/1999/xhtml/vocab">
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="../../sites/files/jps/starberry_favicon.png" type="image/png" />
<meta name="generator" content="Drupal 7 (https://www.drupal.org)" />
<link rel="canonical" href="drupal-8-api-objected-oriented-programming-conventions.html" />
<link rel="shortlink" href="../../node/662.html" />
  <title>Drupal 8 API: objected-oriented programming conventions | J-P Stacey</title>
  <link type="text/css" rel="stylesheet" href="../../sites/files/jps/css/css_xE-rWrJf-fncB6ztZfd2huxqgxu4WO-qwma6Xer30m4.css" media="all" />
<link type="text/css" rel="stylesheet" href="../../sites/files/jps/css/css_jdej_Zz2sjg--A2C2aVJ-Qt5W-fI_fkFnsddutilsws.css" media="all" />
<link type="text/css" rel="stylesheet" href="../../sites/files/jps/css/css_A3Qn9PgslsjDpW1HfgFuI26cQlhJ23E7y9wyYqpiJIA.css" media="all" />
<link type="text/css" rel="stylesheet" href="../../sites/files/jps/css/css_0Heb-O6YY5Tn5xG4WrHtAAXZCtYk-eKiVo7PlP1bsg4.css" media="all" />
<link type="text/css" rel="stylesheet" href="../../sites/files/jps/css/css_2THG1eGiBIizsWFeexsNe1iDifJ00QRS9uSd03rY9co.css" media="print" />

<!--[if lte IE 7]>
<link type="text/css" rel="stylesheet" href="http://jpstacey.lndo.site/sites/default/themes/custom/barthes/css/ie.css?qfgo2z" media="all" />
<![endif]-->

<!--[if IE 6]>
<link type="text/css" rel="stylesheet" href="http://jpstacey.lndo.site/sites/default/themes/custom/barthes/css/ie6.css?qfgo2z" media="all" />
<![endif]-->
  <script type="text/javascript" src="../../sites/files/jps/js/js_vDrW3Ry_4gtSYaLsh77lWhWjIC6ml2QNkcfvfP5CVFs.js"></script>
<script type="text/javascript" src="../../sites/files/jps/js/js_gPqjYq7fqdMzw8-29XWQIVoDSWTmZCGy9OqaHppNxuQ.js"></script>
<script type="text/javascript">
<!--//--><![CDATA[//><!--
(function(i,s,o,g,r,a,m){i["GoogleAnalyticsObject"]=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,"script","https://www.google-analytics.com/analytics.js","ga");ga("create", "UA-4775024-1", {"cookieDomain":"auto"});ga("set", "anonymizeIp", true);ga("send", "pageview");
//--><!]]>
</script>
<script type="text/javascript">
<!--//--><![CDATA[//><!--
jQuery.extend(Drupal.settings, {"basePath":"\/","pathPrefix":"","ajaxPageState":{"theme":"barthes","theme_token":"1pZnezzzfjC3LfgTsP0TA8sT5hY72NQLCJf40hvrSFk","js":{"misc\/jquery.js":1,"misc\/jquery.once.js":1,"misc\/drupal.js":1,"sites\/all\/modules\/google_analytics\/googleanalytics.js":1,"0":1},"css":{"modules\/system\/system.base.css":1,"modules\/system\/system.menus.css":1,"modules\/system\/system.messages.css":1,"modules\/system\/system.theme.css":1,"modules\/comment\/comment.css":1,"sites\/all\/modules\/date\/date_api\/date.css":1,"sites\/all\/modules\/date\/date_popup\/themes\/datepicker.1.7.css":1,"modules\/field\/theme\/field.css":1,"sites\/all\/modules\/mollom\/mollom.css":1,"modules\/node\/node.css":1,"modules\/search\/search.css":1,"modules\/user\/user.css":1,"sites\/all\/modules\/views\/css\/views.css":1,"sites\/all\/modules\/media\/modules\/media_wysiwyg\/css\/media_wysiwyg.base.css":1,"sites\/all\/modules\/ctools\/css\/ctools.css":1,"public:\/\/geshi\/geshifilter-languages.css":1,"sites\/all\/modules\/geshifilter\/geshifilter.css":1,"themes\/bartik\/css\/layout.css":1,"themes\/bartik\/css\/style.css":1,"sites\/default\/themes\/custom\/barthes\/css\/colors.css":1,"sites\/default\/themes\/custom\/barthes\/css\/custom.css":1,"themes\/bartik\/css\/print.css":1,"sites\/default\/themes\/custom\/barthes\/css\/ie.css":1,"sites\/default\/themes\/custom\/barthes\/css\/ie6.css":1}},"googleanalytics":{"trackOutbound":1,"trackMailto":1,"trackDownload":1,"trackDownloadExtensions":"7z|aac|arc|arj|asf|asx|avi|bin|csv|doc(x|m)?|dot(x|m)?|exe|flv|gif|gz|gzip|hqx|jar|jpe?g|js|mp(2|3|4|e?g)|mov(ie)?|msi|msp|pdf|phps|png|ppt(x|m)?|pot(x|m)?|pps(x|m)?|ppam|sld(x|m)?|thmx|qtm?|ra(m|r)?|sea|sit|tar|tgz|torrent|txt|wav|wma|wmv|wpd|xls(x|m|b)?|xlt(x|m)|xlam|xml|z|zip"}});
//--><!]]>
</script>
</head>
<body class="html not-front not-logged-in one-sidebar sidebar-second page-node page-node- page-node-662 node-type-blog" >
  <div id="skip-link">
    <a href="drupal-8-api-objected-oriented-programming-conventions.html#main-content" class="element-invisible element-focusable">Skip to main content</a>
  </div>
    <div id="page-wrapper"><div id="page">

  <div id="header" class="with-secondary-menu"><div class="section clearfix">

    
          <div id="name-and-slogan">

                              <div id="site-name">
              <strong>
                <a href="../../index.html" title="Home" rel="home"><span>J-P Stacey</span></a>
              </strong>
            </div>
                  
                  <div id="site-slogan">
            Drupal, programming culture, gardening, cycling and the environment          </div>
        
      </div> <!-- /#name-and-slogan -->
    
    
    
          <div id="secondary-menu" class="navigation">
        <h2 class="element-invisible">Secondary menu</h2><ul id="secondary-menu-links" class="links inline clearfix"><li class="menu-7322 first"><a href="../../cv.html" title="My curriculum vitae">CV</a></li>
<li class="menu-7320 last"><a href="../../contact.html" title="">Contact me</a></li>
</ul>      </div> <!-- /#secondary-menu -->
    
  </div></div> <!-- /.section, /#header -->

  
  
  <div id="main-wrapper" class="clearfix"><div id="main" class="clearfix">

    
    
    <div id="content" class="column"><div class="section">
            <a id="main-content"></a>
                    <h1 class="title" id="page-title">
          Drupal 8 API: objected-oriented programming conventions        </h1>
                          <div class="tabs">
                  </div>
                          <div class="region region-content">
    <div id="block-system-main" class="block block-system">

    
  <div class="content">
    <div  class="ds-1col node node-blog node-promoted node-full view-mode-full clearfix">

  
  <div class="field field-name-post-date field-type-ds field-label-hidden"><div class="field-items"><div class="field-item even">Tuesday, October 11, 2016 - 12:04</div></div></div><div class="field field-name-field-body field-type-text-long field-label-hidden"><div class="field-items"><div class="field-item even"><h2>Pre-requisites</h2>
<ul><li><a href="/blog/2016-09-13/drupal-8-api-extending-and-altering-drupal.html">Extending and altering Drupal</a></li>
</ul><h2>Naming conventions for both manual and automatic discovery</h2>
<p>Even before Drupal adopted object-oriented (OO) principles as heavily as 8 has done, it's always used naming conventions in part as a way of working out where a particular thing should be (the key example is hook function naming.) And Drupal has always had <a href="https://www.drupal.org/docs/develop/coding-standards">great coding standards</a> (which incidentally <a href="https://www.drupal.org/docs/develop/coding-standards/api-documentation-and-comment-standards#classes">cover PHP classes</a>). But we must go one step further than informal standards, to ensure that classes are always findable by some automatic system like Drupal itself.</p>
<p><a href="http://php.net/manual/en/language.oop5.autoload.php">PHP has a principle of autoloading</a>, whereby if an OO component (e.g. a class) is requested, but is not yet known to the current PHP process, it will ask an autoloading registry where it might look for a file containing the component. Separately, there is a <a href="http://www.php-fig.org/psr/psr-4/">PSR-4 standard</a> for class, trait and interface naming which, by mandating a combination of namespace-plus-classname, and subdirectory-plus-filename, PSR-4 ensures that any class referenced in any code is automatically discoverable and loadable.</p>
<p>Drupal 8 adopts and recommends PSR-4: that means that, if you name(space) your classes correctly, and put them in the right files (and subfolders), then they will be discoverable to Drupal.</p>
<h2>OO naming conventions specific to Drupal</h2>
<p>PSR-4 is adaptable to lots of different folder structures, but in Drupal it's set up so that:</p>
<ol><li>If you have a module called <span class="geshifilter"><code class="text geshifilter-text">modulename</code></span></li>
<li>And you want to store a class in a file deep in some subdirectory of its <span class="geshifilter"><code class="text geshifilter-text">src/</code></span> subfolder e.g. <span class="geshifilter"><code class="text geshifilter-text">src/FolderOne/FolderTwo/FileName.php</code></span></li>
<li>Then your class <em>must</em> begin with the PHP <span class="geshifilter"><code class="text geshifilter-text">namespace Drupal\modulename\FolderOne\FolderTwo</code></span></li>
<li>And the class name <em>must</em> be <span class="geshifilter"><code class="text geshifilter-text">FileName</code></span>.</li>
</ol><p>As long as your class name(space) and its file location are consistent in this way, PSR-4 means Drupal can always find the source code for your class. (The same obviously goes for PHP traits, interfaces etc.)</p>
<p>A couple of key consequences of these requirements are:</p>
<ul><li>All object-oriented code goes in the <span class="geshifilter"><code class="text geshifilter-text">src/</code></span> subfolder: no exceptions, as otherwise it can't be found at all by autoloading.</li>
<li>You should only ever have one OO class etc. per file, because the class name must match the file name.</li>
</ul><p>Below, we'll look at a counterexample for the second point, to illustrate why it's important.</p>
<h2>Creating and then finding a new class</h2>
<p>In the folder for the <span class="geshifilter"><code class="text geshifilter-text">d8api</code></span> module you created previously, create a <span class="geshifilter"><code class="text geshifilter-text">src/</code></span> subfolder. Within that, create a further <span class="geshifilter"><code class="text geshifilter-text">src/Convention/</code></span> subfolder. </p>
<p>Then, in the latter, add the following file and call it <span class="geshifilter"><code class="text geshifilter-text">Test.php</code></span>:</p>
<div class="geshifilter">
<pre class="php geshifilter-php" style="font-family:monospace;"><span class="kw2">&lt;?php</span>
 
<span class="kw2">namespace</span> Drupal\d8api\Convention<span class="sy0">;</span>
 
<span class="co4">/**
 * Test class.
 */</span>
<span class="kw2">class</span> Test <span class="br0">{</span>
<span class="br0">}</span>
 
<span class="co4">/**
 * This class should not be here &amp; it violates PSR-4, but
 * we're going to use it in testing to show what the problem is.
 */</span>
<span class="kw2">class</span> ContraryToPsr4 <span class="br0">{</span>
<span class="br0">}</span> </pre></div>
<p>So this file is <span class="geshifilter"><code class="text geshifilter-text">src/Convention/Test.php</code></span> within your <span class="geshifilter"><code class="text geshifilter-text">d8api/</code></span> module folder.</p>
<h2>What you should see</h2>
<p>In order to test this code, you should <a href="http://docs.drush.org/en/master/install/">install Drush</a>. We don't cover that process here.</p>
<p>With Drush installed, open a terminal and change the directory so you're inside the codebase for your Drupal site. You can then type the following:</p>
<div class="geshifilter">
<pre class="bash geshifilter-bash" style="font-family:monospace;">drush php-eval <span class="st_h">'print get_class(new \Drupal\d8api\Convention\Test) . "\n";'</span></pre></div>
<p>The response will be:</p>
<div class="geshifilter">
<pre class="bash geshifilter-bash" style="font-family:monospace;">Drupal\d8api\Convention\Test</pre></div>
<p>Drupal has successfully (a) found your class file, based on the PSR-4-compatible naming conventions (b) loaded the file (c) and created an object instance of the class. The naming convention has worked.</p>
<p>If you edit the class name, or the namespace, without renaming files and folders to match, you'll find that Drush will rapidly be unable to find the class on demand; for example, even if you edit the namespace in <span class="geshifilter"><code class="text geshifilter-text">Test.php</code></span>, then if it's still in the <span class="geshifilter"><code class="text geshifilter-text">src/Convention/</code></span> subfolder:</p>
<div class="geshifilter">
<pre class="bash geshifilter-bash" style="font-family:monospace;">drush php-eval <span class="st_h">'print get_class(new \Drupal\d8api\SomethingElse\Test) . "\n";'</span>
<span class="co0"># Output:</span>
PHP Fatal error:  Class <span class="st_h">'Drupal\d8api\SomethingElse\Test'</span> not found</pre></div>
<p>It won't work! Class name must match filename; class namespace must relate to subfolder structure.</p>
<p>Speaking of which, what about the other class we added to the file—<span class="geshifilter"><code class="text geshifilter-text">ContraryToPsr4</code></span>—in contravention of the PSR-4 conventions? Obviously, it can't be found:</p>
<div class="geshifilter">
<pre class="bash geshifilter-bash" style="font-family:monospace;">drush php-eval <span class="st_h">'print get_class(new \Drupal\d8api\Convention\ContraryToPsr4) . "\n";'</span>
<span class="co0"># Output:</span>
PHP Fatal error:  Class <span class="st_h">'Drupal\d8api\Convention\ContraryToPsr4'</span> not found</pre></div>
<p><em>However</em>, it's worth pointing out a quirk with autoloading. If you autoload the <span class="geshifilter"><code class="text geshifilter-text">Test</code></span> class <em>first</em>, then it just so happens that the <span class="geshifilter"><code class="text geshifilter-text">ContraryToPsr4</code></span> class is loaded along with it. So if you then try to use the latter, doing so doesn't have to trigger autoloading/discovery, so it will appear to work:</p>
<div class="geshifilter">
<pre class="bash geshifilter-bash" style="font-family:monospace;">drush php-eval <span class="st_h">'print get_class(new \Drupal\d8api\Convention\Test) . "\n"; print get_class(new \Drupal\d8api\Convention\ContraryToPsr4) . "\n";'</span>
<span class="co0"># Output:</span>
Drupal\d8api\Convention\Test
Drupal\d8api\Convention\ContraryToPsr4</pre></div>
<p>Once you've seen that happen, you're tempted to rely on it for loading code: especially when you yourself will only ever use the two classes (or a class and an interface) together. But it means that your classes are no longer usable in isolation, making your code brittle. This is inevitably dangerous as far as the rest of the Drupal framework is concerned; for example, if you reverse the order of autoloading:</p>
<div class="geshifilter">
<pre class="bash geshifilter-bash" style="font-family:monospace;">drush php-eval <span class="st_h">'print get_class(new \Drupal\d8api\Convention\ContraryToPsr4) . "\n"; print get_class(new \Drupal\d8api\Convention\Test) . "\n";'</span>
<span class="co0"># Output:</span>
PHP Fatal error:  Class <span class="st_h">'Drupal\d8api\Convention\ContraryToPsr4'</span> not found</pre></div>
<p>then it will break as expected: the autoloader tries to discover the first class it needs, and fails early. So always limit any given file to a single class or similar OO component, because you never know how other people's code might need to use your own.</p>
<p>If you can reproduce these results, then congratulations! you've successfully leveraged Drupal's OO programming conventions.</p>
<h2>Further reading etc.</h2>
<ul><li><a href="https://api.drupal.org/api/drupal/core%21core.api.php/group/oo_conventions/8.2.x">Drupal 8 API: Objected-oriented programming conventions</a></li>
<li><a href="https://www.drupal.org/node/608152">Develop: Coding standards: Object oriented code</a></li>
<li><a href="http://www.php-fig.org/psr/psr-4/">The PSR-4 recommendation</a></li>
</ul></div></div></div><div id="comments" class="comment-wrapper">
  
  
  </div>
</div>

  </div>
</div>
  </div>
      
    </div></div> <!-- /.section, /#content -->

          <div id="sidebar-second" class="column sidebar"><div class="section">
          <div class="region region-sidebar-second">
    <div id="block-block-7" class="block block-block">

    <h2>I&#039;m a Drupal Association member!</h2>
  
  <div class="content">
    <div style="margin: -15px 0"><a href="https://drupal.org/user/130486"><img src="https://association.drupal.org/files/Drupal_Association_ind_member_217_0.png" alt="My individual membership of the Drupal Association" title="You can view my DA membership on drupal.org" width="168" height="168" /></a></div>
  </div>
</div>
<div id="block-block-10" class="block block-block">

    <h2>Drupal 8 API tutorials</h2>
  
  <div class="content">
    <p>Want to learn about the Drupal 8 APIs, with worked examples? <a href="/d8api.html">Follow my series of tutorials</a>, covering routing, caching, entities, config and much more!</p>
  </div>
</div>
<div id="block-stateblock-stateblock" class="block block-stateblock">

    <h2>Want to hire me?</h2>
  
  <div class="content">
    <a href="../../contact.html"><section class="state-no">
  <header>I'm currently</header>
  <section class="state-description">fully booked</section>
  <footer>for freelance work. But you can click here to contact me!</footer>
</section></a>  </div>
</div>
<div id="block-ds-extras-blogpost-secondary-nav" class="block block-ds-extras">

    
  <div class="content">
    <div class="field field-name-taxonomy-vocabulary-6 field-type-taxonomy-term-reference field-label-above clearfix"><h3 class="field-label">Blog category: </h3><ul class="links"><li class="taxonomy-term-reference-0"><a href="../../category/wordpress-category/framework.html">framework</a></li></ul></div><div class="field field-name-taxonomy-vocabulary-7 field-type-taxonomy-term-reference field-label-above clearfix"><h3 class="field-label">Tags: </h3><ul class="links"><li class="taxonomy-term-reference-0"><a href="../../category/tags/d8api.html">d8api</a>, <a href="../../category/tags/d8apibg.html">d8api:bg</a></li></ul></div>  </div>
</div>
<div id="block-views-recent-blog-block-1" class="block block-views">

    <h2>Recent blogposts</h2>
  
  <div class="content">
    <div class="view view-recent-blog view-id-recent_blog view-display-id-block_1 view-dom-id-4e3560aee4c416f3e86902e79dfa6a8d">
        
  
  
      <div class="view-content">
        <ul>
    <li class="first odd">
      
      <h3>
  
    
      <a href="../2017-07-21/altering-length-drupal-8-text-field-contains-data.html">Altering the length of a Drupal 8 text field that contains data</a>
      </h3>
  

      <div>
  
    
      Friday, July 21, 2017 - 11:31
      </div>
  
    </li>
      <li class="even">
      
      <h3>
  
    
      <a href="../2017-06-02/menagerie-testing-behavioural-unit-system-smoke-regression-oh-my.html">A menagerie of testing: behavioural, unit, system, smoke, regression, oh my!</a>
      </h3>
  

      <div>
  
    
      Friday, June 2, 2017 - 10:11
      </div>
  
    </li>
      <li class="last odd">
      
      <h3>
  
    
      <a href="../2017-05-30/including-javascript-behat-tests-all-inside-headless-virtual-machine.html">Including Javascript in Behat tests, all inside a headless, virtual machine</a>
      </h3>
  

      <div>
  
    
      Tuesday, May 30, 2017 - 16:51
      </div>
  
    </li>
    </ul>
    </div>
  
  
  
      
<div class="more-link">
  <a href="../../blog_view.html">
    All blogposts  </a>
</div>
  
  
  
</div>  </div>
</div>
<div id="block-block-5" class="block block-block">

    <h2>About me</h2>
  
  <div class="content">
    <p>I'm J-P Stacey, and I'm a freelance technical developer and software architect, working with <a href="http://drupal.org/">Drupal</a>, Javascript, Symfony, PHP and devops, with experience in project and process management and an emphasis on usability.</p>
<p>I live in the <a href="http://gov.uk">UK</a>; my website is self-hosted on <a href="http://bigv.io">bigv.io</a>; my email is hosted by <a href="http://mail.google.com">Google</a>, and that's also what I use to share files. <small>(<a href="https://data-jurisdiction.org/country/GB">More info</a>|<a href="/blog/2013-08-20/what-jurisdiction-am-i-in.html">What is this?</a>)</small></p>
  </div>
</div>
<div id="block-menu-secondary-menu" class="block block-menu">

    <h2>Find me elsewhere</h2>
  
  <div class="content">
    <ul class="menu clearfix"><li class="first leaf"><a href="http://twitter.com/mphield" title="My commercial account on Twitter">Company @ Twitter</a></li>
<li class="leaf"><a href="http://drupal.org/user/130486" title="Drupal user #130486: woohoo!">Drupal @ d.o</a></li>
<li class="leaf"><a href="http://github.com/jpstacey" title="My code repositories on Github">Code @ Github</a></li>
<li class="leaf"><a href="http://flickr.com/photos/eustatius" title="My photos on Flickr">Photos @ Flickr</a></li>
<li class="last leaf"><a href="http://pinboard.in/u:jpstacey" title="My links on the Pinboard bookmarking site">Links @ Pinboard</a></li>
</ul>  </div>
</div>
  </div>
      </div></div> <!-- /.section, /#sidebar-second -->
    
  </div></div> <!-- /#main, /#main-wrapper -->

  
  <div id="footer-wrapper"><div class="section">

    
    
  </div></div> <!-- /.section, /#footer-wrapper -->

</div></div> <!-- /#page, /#page-wrapper -->
  </body>
</html>
